// ==UserScript==
// @name         GRV Tools com Endereço e Policial 3 em 1 v1.4.1
// @namespace    vitor.grv.tools
// @version      1.4.1
// @description  LISTA (canônica) + ENDEREÇO (Apreensão/Remoção/Ambos – opcional) + POLICIAL (opcional, via DETALHE). Situação por status, datas sem .000000. Exporta XLSX/TSV. UI aprovada (padrão: filtro "No pátio"; páginas 1→5; sem atalhos). Força 100 por página, aplica filtro de Situação JÁ NA API e coleta exatamente N×100 mantidos.
// @match        https://intranet.consorciorioparkingcarioca.com/*
// @run-at       document-start
// @grant        none
// @updateURL    https://vitorhaan.github.io/grv-tools-scripts/dist/grv_tools_com_endereco_e_policial_3_em_1_1_4_1_ofuscado.user.js
// @downloadURL  https://vitorhaan.github.io/grv-tools-scripts/dist/grv_tools_com_endereco_e_policial_3_em_1_1_4_1_ofuscado.user.js
// ==/UserScript==


(function(){const d="LyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgR1JWIFRvb2xzIOKAlCAzIGVtIDEgKExpc3RhICsgRW5kZXJlw6dvICsgUG9saWNpYWwpCiAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgIOKWuiBDSEFOR0VMT0cKICAgICB2MS40LjAKICAgICAgIOKAoiBGaWx0cm8gcG9yIFNpdHVhw6fDo28gYXBsaWNhZG8gTk8gU0VSVklET1IgKEFQSSk6IHNlbXByZSBxdWUgbyBmaWx0cm8gZG8KICAgICAgICAgc2NyaXB0IGZvciBudW3DqXJpY28sIG8gcmVxdWVzdCBkYSBMSVNUQSByZWNlYmUgJnN0YXR1cz08Y8OzZGlnbz4uIFBhcmEKICAgICAgICAg4oCcUmV0aXJhZG9zIChxdWFscXVlcinigJ0sIGEgcXVlcnkgZW52aWEgdsOhcmlvcyBzdGF0dXM9ICgxMDAsMTAxLDEwMiwxMDQsCiAgICAgICAgIDEwNSwxMDcsMTA4LDEwOSwxMTApLiBQYXJhIOKAnFRvZG9z4oCdLCBuw6NvIGVudmlhIHN0YXR1cy4KICAgICAgIOKAoiBDb2xldGEgcG9yIG1ldGEgZGUgbWFudGlkb3M6IHNlIEZpbT01LCBvIGNvbGV0b3IgcGFnaW5hIGF0w6kganVudGFyIDXDlzEwMAogICAgICAgICBpdGVucyBxdWUgcGFzc2FtIG5vIGZpbHRybyBkbyBzY3JpcHQgKG91IGF0w6kgYSBsaXN0YSB6ZXJhciksIGVtIHZleiBkZQogICAgICAgICBwYXJhciBlbSA1IHDDoWdpbmFzIGNydWFzLgogICAgICAg4oCiIE1hbnRpZG86IGZvcsOnYSAxMDAgcG9yIHDDoWdpbmEgKGxpbWl0L3BlclBhZ2UvcGFnZVNpemUvc2l6ZSA9IDEwMCkuCiAgICAgICDigKIgUGFkcsOjbyBkZSBpbnRlcnZhbG8gbmEgVUk6IEluw61jaW89MSwgRmltPTUgKHZvY8OqIHDDtWUgMCBxdWFuZG8gcXVpc2VyCiAgICAgICAgIHZhcnJlciBhdMOpIGEgcHJpbWVpcmEgcMOhZ2luYSB2YXppYSkuCgogICAgIHYxLjMuMAogICAgICAg4oCiIChvYnNvbGV0bykgbWV0YSBkZSBtYW50aWRvcyBleGlzdGlhLCBtYXMgYWluZGEgaGF2aWEgdW0gbGltaXRlIG9jdWx0byBkZQogICAgICAgICDigJxww6FnaW5hcyBjcnVhc+KAnS4gUmVtb3ZpZG8gbmVzdGEgdmVyc8Ojby4KCiAgICAgdjEuMi4wCiAgICAgICDigKIgVFNWIGVzdMOhdmVsIChzYW5pdGl6YcOnw6NvIFxuLCBcdCwgTkJTUCkuCiAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogICDimpbvuI8gU2l0dWHDp8OjbyDigJQgcmVncmEgY2Fuw7RuaWNhIChTRU0gVEVYVE8gZGEgVUkhKQogICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICDigKIgRm9udGUgZGEgdmVyZGFkZTogc3RhdHVzIG51bcOpcmljbyBkYSBMSVNUQS4KICAg4oCiIE1hcGE6CiAgICAgICAgMDogIlBlbmRlbnRlIgogICAgICAgIDE6ICJObyBww6F0aW8iCiAgICAgICAgMjogIkVtIGxlaWzDo28iCiAgICAgICAgNDogIkNsb25lIgogICAgICAgIDU6ICJFeGNsdWlyIgogICAgICAgIDY6ICJGcnVzdHJhZG8iCiAgICAgICAgMTAwOiAiUmV0aXJhZG8gcGVsbyBwcm9wcmlldMOhcmlvIgogICAgICAgIDEwMTogIlJldGlyYWRvIHBvciBsZWlsw6NvIgogICAgICAgIDEwMjogIlJldGlyYWRvIHBvciBkZWNpc8OjbyBqdWRpY2lhbCIKICAgICAgICAxMDQ6ICJSZXRpcmFkbyBwZWxvIHJlcHJlc2VudGFudGUgbGVnYWwiCiAgICAgICAgMTA1OiAiUmV0aXJhZG8gcG9yIHByZW5zYSIKICAgICAgICAxMDc6ICJSZXRpcmFkbyBwb3IgbGVpbMOjbyBleHRlcm5vIgogICAgICAgIDEwODogIlJldGlyYWRvIHBvciByb3Viby9mdXJ0byIKICAgICAgICAxMDk6ICJSZXRpcmFkbyBwb3IgbGVpbMOjbyBwZWxvIHJlcHJlc2VudGFudGUgbGVnYWwiCiAgICAgICAgMTEwOiAiUmV0aXJhZG8gcGVsbyByZXByZXNlbnRhbnRlIGxlZ2FsIC0gw5NiaXRvIgoKICAg8J+VkiBEYXRhcyDigJQgcmVtb3ZlciDigJwuMDAwMDAw4oCdIGUgZm9ybWF0YXIgZGQvTU0veXl5eSBISDptbQogICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAg8J+nrSBQb2xpY2lhbCDigJQgREVUQUxIRSBwb3IgaWQgKG51bmNhIHBvciBudW1lcm8pCiAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICDwn6epIEVuZGVyZcOnbyDigJQgTElTVEEgb25seSAoc2VtIGRldGFsaGUpCiAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICDwn5OLIFRTViDigJQgc2FuaXRpemHDp8OjbyBwYXJhIGNvbGFnZW0gcGVyZmVpdGEKICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCihmdW5jdGlvbiAoKSB7CiAgInVzZSBzdHJpY3QiOwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IEVTVEFETyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCiAgY29uc3QgTFNfQkVBUkVSX0tFWSA9ICJncnZ0b29sc19sYXN0X2JlYXJlciI7CgogIGNvbnN0IFNUQVRFID0gewogICAgYXV0aEhlYWRlcjogbG9jYWxTdG9yYWdlLmdldEl0ZW0oTFNfQkVBUkVSX0tFWSkgfHwgIiIsCiAgICBsaXN0QmFzZTogIiIsICAgICAgICAgICAgIC8vIFVSTCBiYXNlIGRhIExJU1RBIChzZW0gcGFnZTsgTUVTTUEgb3JpZ2VtIHBhcmEgbyBERVRBTEhFKQogICAgYmFzZUxvZ2dlZE9uY2U6IGZhbHNlLCAgICAvLyBsb2cg4oCc4pyTIEJhc2UuLi7igJ0gYXBlbmFzIDF4LyBzZXNzw6NvCiAgICByb3dzQU9BOiBudWxsLCAgICAgICAgICAgIC8vIG1hdHJpeiBwYXJhIGV4cG9ydGHDp8OjbwogIH07CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gTUFQQVMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwogIGNvbnN0IFNJVFVBQ0FPX01BUCA9IHsKICAgIDA6ICAgIlBlbmRlbnRlIiwKICAgIDE6ICAgIk5vIHDDoXRpbyIsCiAgICAyOiAgICJFbSBsZWlsw6NvIiwKICAgIDQ6ICAgIkNsb25lIiwKICAgIDU6ICAgIkV4Y2x1aXIiLAogICAgNjogICAiRnJ1c3RyYWRvIiwKICAgIDEwMDogIlJldGlyYWRvIHBlbG8gcHJvcHJpZXTDoXJpbyIsCiAgICAxMDE6ICJSZXRpcmFkbyBwb3IgbGVpbMOjbyIsCiAgICAxMDI6ICJSZXRpcmFkbyBwb3IgZGVjaXPDo28ganVkaWNpYWwiLAogICAgMTA0OiAiUmV0aXJhZG8gcGVsbyByZXByZXNlbnRhbnRlIGxlZ2FsIiwKICAgIDEwNTogIlJldGlyYWRvIHBvciBwcmVuc2EiLAogICAgMTA3OiAiUmV0aXJhZG8gcG9yIGxlaWzDo28gZXh0ZXJubyIsCiAgICAxMDg6ICJSZXRpcmFkbyBwb3Igcm91Ym8vZnVydG8iLAogICAgMTA5OiAiUmV0aXJhZG8gcG9yIGxlaWzDo28gcGVsbyByZXByZXNlbnRhbnRlIGxlZ2FsIiwKICAgIDExMDogIlJldGlyYWRvIHBlbG8gcmVwcmVzZW50YW50ZSBsZWdhbCAtIMOTYml0byIsCiAgfTsKICBjb25zdCBSRVRfU1RBVFVTID0gbmV3IFNldChbMTAwLDEwMSwxMDIsMTA0LDEwNSwxMDcsMTA4LDEwOSwxMTBdKTsKCiAgLy8gT3DDp8O1ZXMgZG8gZmlsdHJvICh2YWxvciBpbnRlcm5vIOKGkiBsYWJlbCBleGliaWRhKQogIGNvbnN0IEZJTFRFUl9PUFRJT05TID0gWwogICAgWyJhbGwiLCAgIlRvZG9zIl0sCiAgICBbIjEiLCAgICAiTm8gcMOhdGlvIl0sICAgICAvLyBwYWRyw6NvIGRhIFVJCiAgICBbIjAiLCAgICAiUGVuZGVudGUiXSwKICAgIFsiMiIsICAgICJFbSBsZWlsw6NvIl0sCiAgICBbIjQiLCAgICAiQ2xvbmUiXSwKICAgIFsiNSIsICAgICJFeGNsdWlyIl0sCiAgICBbIjYiLCAgICAiRnJ1c3RyYWRvIl0sCiAgICBbInJldCIsICAiUmV0aXJhZG9zIChxdWFscXVlcikiXSwKICAgIFsiMTAwIiwgICJSZXRpcmFkbyBwZWxvIHByb3ByaWV0w6FyaW8iXSwKICAgIFsiMTAxIiwgICJSZXRpcmFkbyBwb3IgbGVpbMOjbyJdLAogICAgWyIxMDIiLCAgIlJldGlyYWRvIHBvciBkZWNpc8OjbyBqdWRpY2lhbCJdLAogICAgWyIxMDQiLCAgIlJldGlyYWRvIHBlbG8gcmVwcmVzZW50YW50ZSBsZWdhbCJdLAogICAgWyIxMDUiLCAgIlJldGlyYWRvIHBvciBwcmVuc2EiXSwKICAgIFsiMTA3IiwgICJSZXRpcmFkbyBwb3IgbGVpbMOjbyBleHRlcm5vIl0sCiAgICBbIjEwOCIsICAiUmV0aXJhZG8gcG9yIHJvdWJvL2Z1cnRvIl0sCiAgICBbIjEwOSIsICAiUmV0aXJhZG8gcG9yIGxlaWzDo28gcGVsbyByZXByZXNlbnRhbnRlIGxlZ2FsIl0sCiAgICBbIjExMCIsICAiUmV0aXJhZG8gcGVsbyByZXByZXNlbnRhbnRlIGxlZ2FsIC0gw5NiaXRvIl0sCiAgXTsKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSBVVElMUyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCiAgY29uc3QgcDIgPSAobikgPT4gU3RyaW5nKG4pLnBhZFN0YXJ0KDIsICIwIik7CiAgY29uc3QgdHMgPSAoKSA9PiB7IGNvbnN0IGQ9bmV3IERhdGUoKTsgcmV0dXJuIGAke2QuZ2V0RnVsbFllYXIoKX0tJHtwMihkLmdldE1vbnRoKCkrMSl9LSR7cDIoZC5nZXREYXRlKCkpfV8ke3AyKGQuZ2V0SG91cnMoKSl9aC4ke3AyKGQuZ2V0TWludXRlcygpKX1taW4uJHtwMihkLmdldFNlY29uZHMoKSl9c2VnYDsgfTsKICBjb25zdCBzbGVlcCA9IChtcykgPT4gbmV3IFByb21pc2Uocj0+c2V0VGltZW91dChyLG1zKSk7CiAgY29uc3Qgc2FmZSAgPSAodikgPT4gKHY9PW51bGwgfHwgdj09PSIiKSA/ICItLS0tLSIgOiBTdHJpbmcodik7CiAgY29uc3QgbWFzayAgPSAocyxtYXg9NTQpPT4gIXMgPyAi4oCUIiA6IChzLmxlbmd0aD5tYXggPyAocy5zbGljZSgwLE1hdGguZmxvb3IobWF4LzIpLTEpKyLigKYiK3Muc2xpY2UoLU1hdGguZmxvb3IobWF4LzIpKSkgOiBzKTsKICBjb25zdCBsb2cgICA9IChtKT0+eyB0cnl7IGlmKGxvZ0VsKXsgbG9nRWwudmFsdWUgKz0gbSArICJcbiI7IGxvZ0VsLnNjcm9sbFRvcCA9IGxvZ0VsLnNjcm9sbEhlaWdodDsgfSB9Y2F0Y2h7fSB9OwoKICBmdW5jdGlvbiB1cGRhdGVCYWRnZXMoKXsKICAgIHRyeXsKICAgICAgYmFkZ2VUb2sudGV4dENvbnRlbnQgID0gIlRva2VuOiAiICsgbWFzayhTVEFURS5hdXRoSGVhZGVyLCA0NCk7CiAgICAgIGJhZGdlVG9rLnRpdGxlICAgICAgICA9IFNUQVRFLmF1dGhIZWFkZXIgfHwgIuKAlCI7CiAgICAgIGJhZGdlQmFzZS50ZXh0Q29udGVudCA9ICJCYXNlOiAiICsgbWFzayhTVEFURS5saXN0QmFzZSwgNjApOwogICAgICBiYWRnZUJhc2UudGl0bGUgICAgICAgPSBTVEFURS5saXN0QmFzZSB8fCAi4oCUIjsKICAgIH1jYXRjaHt9CiAgfQoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PSBERVRFQ8OHw4NPIERBIExJU1RBID09PT09PT09PT09PT09PT09PT09PT09PT09ICovCiAgZnVuY3Rpb24gaXNMaXN0KHUpewogICAgdHJ5eyBjb25zdCB1cmw9bmV3IFVSTCh1LGxvY2F0aW9uLm9yaWdpbik7IHJldHVybiAvXlwvYXBpXC9ncnZcLz8kLy50ZXN0KHVybC5wYXRobmFtZSk7IH1jYXRjaHsgcmV0dXJuIGZhbHNlOyB9CiAgfQogIGZ1bmN0aW9uIG5vcm1hbGl6ZUJhc2UodSl7CiAgICB0cnl7CiAgICAgIGNvbnN0IHVybD1uZXcgVVJMKHUsIGxvY2F0aW9uLm9yaWdpbik7CiAgICAgIFsicGFnZSIsInBhZ2luYSIsIl8iLCJ0IiwidHMiLCJub2NhY2hlIiwiY2FjaGVCdXN0IiwibGltaXQiLCJwZXJQYWdlIiwicGFnZVNpemUiLCJzaXplIiwic3RhdHVzIl0uZm9yRWFjaChrPT51cmwuc2VhcmNoUGFyYW1zLmRlbGV0ZShrKSk7CiAgICAgIHVybC5oYXNoPSIiOwogICAgICByZXR1cm4gdXJsLm9yaWdpbiArIHVybC5wYXRobmFtZSArICh1cmwuc2VhcmNoPygiPyIrdXJsLnNlYXJjaFBhcmFtcy50b1N0cmluZygpKToiIik7CiAgICB9Y2F0Y2h7IHJldHVybiBTdHJpbmcodXx8IiIpOyB9CiAgfQogIGZ1bmN0aW9uIGxhdGNoTGlzdEJhc2UodSl7CiAgICBpZiAoIXUgfHwgIWlzTGlzdCh1KSkgcmV0dXJuOwogICAgU1RBVEUubGlzdEJhc2UgPSBub3JtYWxpemVCYXNlKHUpOwogICAgdXBkYXRlQmFkZ2VzKCk7CiAgICBpZiAoIVNUQVRFLmJhc2VMb2dnZWRPbmNlKXsKICAgICAgU1RBVEUuYmFzZUxvZ2dlZE9uY2UgPSB0cnVlOwogICAgICBsb2coIuKckyBCYXNlIGRhIExJU1RBIGRldGVjdGFkYS4iKTsKICAgIH0KICB9CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSBCRUFSRVIgVE9LRU4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCiAgZnVuY3Rpb24gc2V0QmVhcmVyKHYpewogICAgaWYgKCF2KSByZXR1cm47CiAgICBjb25zdCBzPVN0cmluZyh2KS50cmltKCk7CiAgICBpZiAoIXMgfHwgcz09PVNUQVRFLmF1dGhIZWFkZXIpIHJldHVybjsKICAgIFNUQVRFLmF1dGhIZWFkZXI9czsKICAgIHRyeXsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oTFNfQkVBUkVSX0tFWSwgcyk7IH1jYXRjaHt9CiAgICB1cGRhdGVCYWRnZXMoKTsKICB9CiAgY29uc3QgX2ZldGNoID0gd2luZG93LmZldGNoOwogIHdpbmRvdy5mZXRjaCA9IGZ1bmN0aW9uKGlucHV0LCBpbml0KXsKICAgIHRyeXsKICAgICAgY29uc3QgaCA9IGluaXQgJiYgaW5pdC5oZWFkZXJzOwogICAgICBpZiAoaCl7CiAgICAgICAgaWYgKHR5cGVvZiBoLmdldD09PSJmdW5jdGlvbiIpewogICAgICAgICAgY29uc3QgdiA9IGguZ2V0KCJBdXRob3JpemF0aW9uIikgfHwgaC5nZXQoImF1dGhvcml6YXRpb24iKTsgaWYgKHYpIHNldEJlYXJlcih2KTsKICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoaCkpewogICAgICAgICAgZm9yKGNvbnN0IFtrLHZdIG9mIGgpIGlmIChTdHJpbmcoaykudG9Mb3dlckNhc2UoKT09PSJhdXRob3JpemF0aW9uIikgc2V0QmVhcmVyKHYpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGggPT09ICJvYmplY3QiKXsKICAgICAgICAgIGZvcihjb25zdCBrIGluIGgpIGlmIChrLnRvTG93ZXJDYXNlKCk9PT0iYXV0aG9yaXphdGlvbiIpIHNldEJlYXJlcihoW2tdKTsKICAgICAgICB9CiAgICAgIH0KICAgIH1jYXRjaHt9CiAgICBjb25zdCB1cmwgPSAodHlwZW9mIGlucHV0PT09InN0cmluZyIpID8gaW5wdXQgOiAoaW5wdXQgJiYgaW5wdXQudXJsKTsKICAgIHJldHVybiBfZmV0Y2guYXBwbHkodGhpcywgYXJndW1lbnRzKS50aGVuKHJlcz0+ewogICAgICB0cnl7CiAgICAgICAgY29uc3QgdSA9IChyZXMgJiYgcmVzLnVybCkgPyByZXMudXJsIDogKHVybCB8fCAiIik7CiAgICAgICAgaWYgKHJlcyAmJiByZXMub2sgJiYgaXNMaXN0KHUpKSBsYXRjaExpc3RCYXNlKHUpOwogICAgICB9Y2F0Y2h7fQogICAgICByZXR1cm4gcmVzOwogICAgfSk7CiAgfTsKICBjb25zdCBYSFIgPSB3aW5kb3cuWE1MSHR0cFJlcXVlc3Q7CiAgY29uc3QgX29wZW4gPSBYSFIucHJvdG90eXBlLm9wZW47CiAgY29uc3QgX3NldCAgPSBYSFIucHJvdG90eXBlLnNldFJlcXVlc3RIZWFkZXI7CiAgY29uc3QgX3NlbmQgPSBYSFIucHJvdG90eXBlLnNlbmQ7CiAgWEhSLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24obSx1KXsgdGhpcy5fX3VybD11OyByZXR1cm4gX29wZW4uYXBwbHkodGhpcyxhcmd1bWVudHMpOyB9OwogIFhIUi5wcm90b3R5cGUuc2V0UmVxdWVzdEhlYWRlciA9IGZ1bmN0aW9uKGssdil7IHRyeXsgaWYoU3RyaW5nKGspLnRvTG93ZXJDYXNlKCk9PT0iYXV0aG9yaXphdGlvbiIpIHNldEJlYXJlcih2KTt9Y2F0Y2h7fSByZXR1cm4gX3NldC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7IH07CiAgWEhSLnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24oKXsKICAgIHRyeXsKICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgKCk9PnsgdHJ5eyBpZiAodGhpcy5zdGF0dXM+PTIwMCAmJiB0aGlzLnN0YXR1czw0MDAgJiYgaXNMaXN0KHRoaXMuX191cmwpKSBsYXRjaExpc3RCYXNlKHRoaXMuX191cmwpOyB9Y2F0Y2h7fSB9KTsKICAgIH1jYXRjaHt9CiAgICByZXR1cm4gX3NlbmQuYXBwbHkodGhpcyxhcmd1bWVudHMpOwogIH07CiAgZnVuY3Rpb24gdHJ5UGVyZigpewogICAgdHJ5ewogICAgICBjb25zdCBlcz1wZXJmb3JtYW5jZS5nZXRFbnRyaWVzQnlUeXBlKCJyZXNvdXJjZSIpOwogICAgICBmb3IobGV0IGk9ZXMubGVuZ3RoLTE7aT49MDtpLS0peyBjb25zdCB1PWVzW2ldLm5hbWV8fCIiOyBpZihpc0xpc3QodSkpeyBsYXRjaExpc3RCYXNlKHUpOyBicmVhazsgfSB9CiAgICB9Y2F0Y2h7fQogIH0KCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSBSRURFL0xJU1RBID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCiAgLy8g4pa6IEFwbGljYSBvIGZpbHRybyBkZSBTaXR1YcOnw6NvIErDgSBOQSBBUEkgYWRpY2lvbmFuZG8gc3RhdHVzPSBuYSBxdWVyeS4KICAvLyAgICAtIGZpbHRlclZhbHVlICJhbGwiOiBuw6NvIGFkaWNpb25hIG5hZGEuCiAgLy8gICAgLSBmaWx0ZXJWYWx1ZSAicmV0IjogYWRpY2lvbmEgc3RhdHVzPTEwMCZzdGF0dXM9MTAxJi4uLiAodW0gcG9yIGl0ZW0pLgogIC8vICAgIC0gZmlsdGVyVmFsdWUgbnVtw6lyaWNvOiBhZGljaW9uYSBzdGF0dXM9PG51bT4uCiAgZnVuY3Rpb24gYXBwbHlTZXJ2ZXJGaWx0ZXJUb1VybCh1LCBmaWx0ZXJWYWx1ZSl7CiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHUsIGxvY2F0aW9uLm9yaWdpbik7CgogICAgLy8gUmVtb3ZlIHN0YXR1cyBwcsOpLWV4aXN0ZW50ZXMKICAgIHVybC5zZWFyY2hQYXJhbXMuZGVsZXRlKCJzdGF0dXMiKTsKCiAgICBpZiAoZmlsdGVyVmFsdWUgPT09ICJhbGwiKSB7CiAgICAgIHJldHVybiB1cmwudG9TdHJpbmcoKTsKICAgIH0KICAgIGlmIChmaWx0ZXJWYWx1ZSA9PT0gInJldCIpIHsKICAgICAgZm9yIChjb25zdCBzIG9mIFJFVF9TVEFUVVMpIHVybC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJzdGF0dXMiLCBTdHJpbmcocykpOwogICAgICByZXR1cm4gdXJsLnRvU3RyaW5nKCk7CiAgICB9CiAgICBjb25zdCB3YW50ID0gTnVtYmVyKGZpbHRlclZhbHVlKTsKICAgIGlmIChOdW1iZXIuaXNGaW5pdGUod2FudCkpIHsKICAgICAgdXJsLnNlYXJjaFBhcmFtcy5hcHBlbmQoInN0YXR1cyIsIFN0cmluZyh3YW50KSk7CiAgICB9CiAgICByZXR1cm4gdXJsLnRvU3RyaW5nKCk7CiAgfQoKICBhc3luYyBmdW5jdGlvbiBqZ2V0KHUpewogICAgY29uc3QgciA9IGF3YWl0IGZldGNoKHUsIHsgaGVhZGVyczogeyAiQXV0aG9yaXphdGlvbiI6IFNUQVRFLmF1dGhIZWFkZXIgfX0pOwogICAgY29uc3QgdCA9IGF3YWl0IHIudGV4dCgpOwogICAgdHJ5eyByZXR1cm4gSlNPTi5wYXJzZSh0KTsgfWNhdGNoeyB0aHJvdyBuZXcgRXJyb3IoIlJlc3Bvc3RhIG7Do28tSlNPTiIpOyB9CiAgfQoKICAvLyDilrogRm9yw6dhIDEwMCBwb3IgcMOhZ2luYSAoc2VtcHJlKQogIGZ1bmN0aW9uIHBhZ2VVcmwoYmFzZSwgbil7CiAgICBjb25zdCB1ID0gbmV3IFVSTChiYXNlLCBsb2NhdGlvbi5vcmlnaW4pOwoKICAgIC8vIE5vcm1hbGl6YSBhIHDDoWdpbmEKICAgIGlmICh1LnNlYXJjaFBhcmFtcy5oYXMoInBhZ2UiKSkgdS5zZWFyY2hQYXJhbXMuc2V0KCJwYWdlIiwgbik7CiAgICBlbHNlIGlmICh1LnNlYXJjaFBhcmFtcy5oYXMoInBhZ2luYSIpKSB1LnNlYXJjaFBhcmFtcy5zZXQoInBhZ2luYSIsIG4pOwogICAgZWxzZSB1LnNlYXJjaFBhcmFtcy5zZXQoInBhZ2UiLCBuKTsKCiAgICAvLyBJbXDDtWUgMTAwIHBvciBww6FnaW5hIGVtIGNoYXZlcyBjb211bnMKICAgIHUuc2VhcmNoUGFyYW1zLnNldCgibGltaXQiLCAiMTAwIik7CiAgICB1LnNlYXJjaFBhcmFtcy5zZXQoInBlclBhZ2UiLCAiMTAwIik7CiAgICB1LnNlYXJjaFBhcmFtcy5zZXQoInBhZ2VTaXplIiwgIjEwMCIpOwogICAgdS5zZWFyY2hQYXJhbXMuc2V0KCJzaXplIiwgIjEwMCIpOwoKICAgIHJldHVybiB1LnRvU3RyaW5nKCk7CiAgfQoKICBhc3luYyBmdW5jdGlvbiBnZXRMaXN0UGFnZShiYXNlLCBuLCBmaWx0ZXJWYWx1ZSl7CiAgICAvLyAxKSBjb25zdHLDs2kgVVJMIGRhIHDDoWdpbmEgY29tIDEwMCBwb3IgcMOhZ2luYQogICAgbGV0IHUgPSBwYWdlVXJsKGJhc2UsIG4pOwogICAgLy8gMikgaW5qZXRhIGZpbHRybyBkZSBTaXR1YcOnw6NvIG5hIHF1ZXJ5IChzZXJ2ZXItc2lkZSkKICAgIHUgPSBhcHBseVNlcnZlckZpbHRlclRvVXJsKHUsIGZpbHRlclZhbHVlKTsKICAgIGNvbnN0IGQgPSBhd2FpdCBqZ2V0KHUpOwogICAgaWYgKEFycmF5LmlzQXJyYXkoZCkpIHJldHVybiBkOwogICAgZm9yIChjb25zdCBrIG9mIFsiYXJyYXlEYXRhIiwiaXRlbXMiLCJkYXRhIiwicm93cyIsInJlY29yZHMiXSkgaWYgKEFycmF5LmlzQXJyYXkoZD8uW2tdKSkgcmV0dXJuIGRba107CiAgICByZXR1cm4gW107CiAgfQoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0gU0lUVUHDh8ODTyBDQU7DlE5JQ0EgPT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCiAgZnVuY3Rpb24gc2l0dWFjYW9Gcm9tU3RhdHVzKGNvZGUpewogICAgaWYgKFJFVF9TVEFUVVMuaGFzKGNvZGUpKSByZXR1cm4gU0lUVUFDQU9fTUFQW2NvZGVdOwogICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChTSVRVQUNBT19NQVAsIGNvZGUpKSByZXR1cm4gU0lUVUFDQU9fTUFQW2NvZGVdOwogICAgcmV0dXJuIE51bWJlci5pc0Zpbml0ZShjb2RlKSA/IGBTdGF0dXMgJHtjb2RlfWAgOiAiLS0tLS0iOwogIH0KCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT0gRklMVFJPIERFIFNJVFVBw4fDg08gKGZhbGxiYWNrKSA9PT09PT09PT09PT09PT09PSAqLwogIC8vIE1hbnRlbW9zIG8gZmlsdHJvIGNsaWVudC1zaWRlIGNvbW8gc2VndXJhbsOnYSBlbSBjYXNvIGRhIEFQSSBpZ25vcmFyIHN0YXR1cy4KICBmdW5jdGlvbiBwYXNzRmlsdGVyKGNvZGUsIGZpbHRlclZhbHVlKXsKICAgIGlmIChmaWx0ZXJWYWx1ZSA9PT0gImFsbCIpIHJldHVybiB0cnVlOwogICAgaWYgKGZpbHRlclZhbHVlID09PSAicmV0IikgcmV0dXJuIFJFVF9TVEFUVVMuaGFzKGNvZGUpOwogICAgY29uc3Qgd2FudCA9IE51bWJlcihmaWx0ZXJWYWx1ZSk7CiAgICByZXR1cm4gTnVtYmVyLmlzRmluaXRlKHdhbnQpICYmIGNvZGUgPT09IHdhbnQ7CiAgfQoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09IERBVEFTIChMSU1QRVpBKSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCiAgZnVuY3Rpb24gcGFyc2VEYXRlQ2FuZGlkYXRlKHYpewogICAgaWYgKHYgPT0gbnVsbCkgcmV0dXJuIG51bGw7CiAgICBsZXQgeCA9IHY7CiAgICBpZiAodHlwZW9mIHggPT09ICJvYmplY3QiKSB4ID0geC5kYXRlIHx8IHguZGF0YSB8fCB4LmRhdGFIb3JhIHx8IHgudmFsdWUgfHwgeDsKICAgIGlmICh0eXBlb2YgeCAhPT0gInN0cmluZyIpIHggPSBTdHJpbmcoeCk7CiAgICBsZXQgdCA9IHgudHJpbSgpOwogICAgY29uc3QgbSA9IHQubWF0Y2goL14oXGR7NH0tXGR7Mn0tXGR7Mn0pWyBUXShcZHsyfTpcZHsyfTpcZHsyfSkoPzpcLlxkezMsNn0pPyQvKTsKICAgIGlmIChtKSB0ID0gYCR7bVsxXX1UJHttWzJdfWA7CiAgICBjb25zdCBkID0gbmV3IERhdGUodCk7CiAgICBpZiAoIWlzTmFOKGQuZ2V0VGltZSgpKSkgcmV0dXJuIGQ7CiAgICByZXR1cm4gdC5yZXBsYWNlKC9cLlxkezMsNn0kLywgIiIpOwogIH0KICBmdW5jdGlvbiBmbXRCcih2YWwpewogICAgY29uc3QgZCA9IHBhcnNlRGF0ZUNhbmRpZGF0ZSh2YWwpOwogICAgaWYgKGQgPT0gbnVsbCkgcmV0dXJuICItLS0tLSI7CiAgICBpZiAoZCBpbnN0YW5jZW9mIERhdGUpIHJldHVybiBgJHtwMihkLmdldERhdGUoKSl9LyR7cDIoZC5nZXRNb250aCgpKzEpfS8ke2QuZ2V0RnVsbFllYXIoKX0gJHtwMihkLmdldEhvdXJzKCkpfToke3AyKGQuZ2V0TWludXRlcygpKX1gOwogICAgcmV0dXJuIGQ7CiAgfQoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PSBFTkRFUkXDh08gKExJU1RBLU9OTFk7IE9QQ0lPTkFMKSA9PT09PT09PT09PT09PT09PT0gKi8KICBmdW5jdGlvbiBwaWNrRW5kZXJlY29Gcm9tTGlzdChpdGVtLCBvcmlnaW4pewogICAgaWYgKG9yaWdpbiA9PT0gImFwcmVlbnNhbyIpewogICAgICByZXR1cm4gWwogICAgICAgIHNhZmUoaXRlbT8uZW5kZXJlY29BcHJlZW5zYW8pLAogICAgICAgIHNhZmUoaXRlbT8uYmFpcnJvQXByZWVuc2FvKSwKICAgICAgICBzYWZlKGl0ZW0/LmNpZGFkZUFwcmVlbnNhbyksCiAgICAgICAgc2FmZShpdGVtPy51ZkFwcmVlbnNhbyksCiAgICAgICAgc2FmZShpdGVtPy5jb21wbGVtZW50b0FwcmVlbnNhbyksCiAgICAgIF07CiAgICB9IGVsc2UgeyAvLyByZW1vY2FvCiAgICAgIHJldHVybiBbCiAgICAgICAgc2FmZShpdGVtPy5lbmRlcmVjb1JlbW9jYW8pLAogICAgICAgIHNhZmUoaXRlbT8uYmFpcnJvUmVtb2NhbyksCiAgICAgICAgc2FmZShpdGVtPy5jaWRhZGVSZW1vY2FvKSwKICAgICAgICBzYWZlKGl0ZW0/LnVmUmVtb2NhbyksCiAgICAgICAgc2FmZShpdGVtPy5jb21wbGVtZW50b1JlbW9jYW8pLAogICAgICBdOwogICAgfQogIH0KCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IFBPTElDSUFMIChERVRBTEhFKSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KICBmdW5jdGlvbiBnZXRQb2xpY2lhbE9maWNpYWxGcm9tRGV0YWxoZShkZXQpewogICAgY29uc3QgcCA9IGRldD8ucG9saWNpYWxBcHJlZW5zYW8gfHwgZGV0Py5wb2xpY2lhbCB8fCBkZXQ/LmFnZW50ZUFwcmVlbnNvciB8fCBudWxsOwogICAgY29uc3Qgbm9tZSA9IHNhZmUocD8ubm9tZSk7CiAgICBjb25zdCBtYXQgID0gc2FmZShwPy5tYXRyaWN1bGEpOwogICAgcmV0dXJuIHtub21lLCBtYXR9OwogIH0KICBmdW5jdGlvbiBwYXJzZVBvbGljaWFsRnJvbU9ic2VydmFjYW8odGV4dCl7CiAgaWYgKCF0ZXh0KSByZXR1cm4ge25vbWVPYnM6Ii0tLS0tIiwgbWF0T2JzOiItLS0tLSJ9OwoKICAvLyBOb3JtYWxpemHDp8OjbwogIGxldCB0ID0gU3RyaW5nKHRleHQpCiAgICAucmVwbGFjZSgvXHJcbj8vZywgIlxuIikKICAgIC5yZXBsYWNlKC9cdTAwQTAvZywgIiAiKQogICAgLnJlcGxhY2UoL1wqKy9nLCAiIikgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBuZWdyaXRvL2FzdGVyaXNjb3MKICAgIC5yZXBsYWNlKC9bIFx0XSsvZywgIiAiKQogICAgLnJlcGxhY2UoL1sgXHRdKlxuWyBcdF0qL2csICJcbiIpOwogIC8vIEp1bnRhIGTDrWdpdG9zIHF1ZWJyYWRvcyBwb3IgcXVlYnJhIGRlIGxpbmhhCiAgdCA9IHQucmVwbGFjZSgvKFxkKVteXFNcbl0qXG5bXlxTXG5dKihcZCkvZywgIiQxJDIiKTsKCiAgY29uc3QgZGlnaXRzID0gcyA9PiBTdHJpbmcoc3x8IiIpLnJlcGxhY2UoL1xEKy9nLCAiIik7CiAgY29uc3QgY2xlYW4gID0gcyA9PiBTdHJpbmcoc3x8IiIpLnJlcGxhY2UoL1sgXHRdKy9nLCAiICIpLnRyaW0oKTsKCiAgLy8gLS0tLS0tLS0tLSBNYXRyw61jdWxhL1JHIC0tLS0tLS0tLS0KICBsZXQgbWF0T2JzID0gIi0tLS0tIjsKICAvLyBSw7N0dWxvcyBjb20gZGVsaW1pdGFkb3JlcyBkZSBwYWxhdnJhIHBhcmEgZXZpdGFyIGZhbHNvLXBvc2l0aXZvIChleC46ICJDYXJnby9QYXRlbnRlIikKICBjb25zdCBtID0gdC5tYXRjaCgvXGIoPzpNYXRcLj9ccypcLz9ccypSR3xNYXRyKD86XC58W8OtaV1jdWxhKT98TWF0cmljKD86dWxhKT98TWF0XC4/fFJHKD86XC9JRCk/KVxiXHMqWzpcLV0/XHMqKFteXG5dKykvaSk7CiAgaWYgKG0pewogICAgY29uc3QgZCA9IGRpZ2l0cyhtWzFdKTsKICAgIGlmIChkLmxlbmd0aD49NSAmJiBkLmxlbmd0aDw9MTIpIHsKICAgICAgbWF0T2JzID0gZDsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IG1kID0gbVsxXS5tYXRjaCgvXGIoXGR7NSwxMn0pXGIvKTsKICAgICAgaWYgKG1kKSBtYXRPYnMgPSBtZFsxXTsKICAgIH0KICB9IGVsc2UgewogICAgLy8gRmFsbGJhY2sgcmVzdHJpdG86IGxpbmhhIHF1ZSBtZW5jaW9uYSBNYXQvUkcgKGV2aXRhIHBlZ2FyICJDZWwuIi90ZWxlZm9uZSkKICAgIGNvbnN0IGxpbmUgPSB0LnNwbGl0KCJcbiIpLmZpbmQobCA9PiAvXGJNYXQvaS50ZXN0KGwpIHx8IC9cYlJHXGIvaS50ZXN0KGwpKTsKICAgIGlmIChsaW5lKXsKICAgICAgY29uc3QgZHJvcCA9IGxpbmUucmVwbGFjZSgvQ2VsXC4/Oi4qJC9pLCAiIik7CiAgICAgIGNvbnN0IGQgPSBkaWdpdHMoZHJvcCk7CiAgICAgIGNvbnN0IG1kID0gZC5tYXRjaCgvKFxkezUsMTJ9KS8pOwogICAgICBpZiAobWQpIG1hdE9icyA9IG1kWzFdOwogICAgfQogIH0KCiAgLy8gLS0tLS0tLS0tLSBOb21lIC0tLS0tLS0tLS0KICBsZXQgbm9tZU9icyA9ICItLS0tLSI7CiAgLy8gIk5vbWUgZSBDYXJnby9QYXRlbnRlOiIgb3UgIk5vbWU6IC4uLiIKICBsZXQgbiA9IHQubWF0Y2goL1xiTm9tZVxzKig/OmVccypDYXJnb1wvP1BhdGVudGV8XC8/Q2FyZ29cLz9QYXRlbnRlKT9ccyo6XHMqKFteXG5dKykvaSk7CiAgaWYgKG4pewogICAgbGV0IHNlZyA9IG5bMV07CiAgICAvLyBDb3J0YSBzZSBhIG1lc21hIGxpbmhhIGNvbnRpbnVhciBjb20gb3V0cm9zIHLDs3R1bG9zCiAgICBzZWcgPSBzZWcuc3BsaXQoL1xiKE1hdFwuP1wvP1JHfE1hdFwuP3xNYXRyKD86XC58W8OtaV1jdWxhKT98UkcoPzpcL0lEKT98VW5pZGFkZXxOW8K6b11ccypkYVxzKlZUUnxDZWxcLj8pXGIvaSlbMF07CiAgICBub21lT2JzID0gY2xlYW4oc2VnKTsKICB9IGVsc2UgaWYgKChuID0gdC5tYXRjaCgvXGJOb21lXHMqOlxzKihbXlxuXSspL2kpKSl7CiAgICBsZXQgc2VnID0gblsxXTsKICAgIHNlZyA9IHNlZy5zcGxpdCgvXGIoQ2FyZ298Q2FyZ29cLz9QYXRlbnRlfE1hdFwuP1wvP1JHfE1hdFwuP3xNYXRyKD86XC58W8OtaV1jdWxhKT98UkcoPzpcL0lEKT8pXGIvaSlbMF07CiAgICBub21lT2JzID0gY2xlYW4oc2VnKTsKICB9IGVsc2UgaWYgKChuID0gdC5tYXRjaCgvXGIoUG9saWNpYWx8QXByZWVuc29yfEFnZW50ZXxJbnNwZXRvcnxPZmljaWFsKVxzKjpccyooW15cbl0rKS9pKSkpIHsKICAgIG5vbWVPYnMgPSBjbGVhbihuWzJdKTsKICB9IGVsc2UgewogICAgLy8gSGV1csOtc3RpY2E6IHByaW1laXJhIGxpbmhhIMO6dGlsIGFww7NzICJEQURPUyBETyBTT0xJQ0lUQU5URSIKICAgIGxldCBhZnRlciA9IHQ7CiAgICBjb25zdCBoID0gdC5tYXRjaCgvREFET1MgRE8gU09MSUNJVEFOVEUvaSk7CiAgICBpZiAoaCkgYWZ0ZXIgPSB0LnNsaWNlKGguaW5kZXggKyBoWzBdLmxlbmd0aCk7CiAgICBjb25zdCBsaW5lID0gYWZ0ZXIuc3BsaXQoIlxuIikubWFwKHM9PnMudHJpbSgpKQogICAgICAuZmluZChzID0+IHMgJiYgIS9eXGR7NSx9JC8udGVzdChkaWdpdHMocykpICYmICEvKFVuaWRhZGV8VlRSfENlbHxGb2kgYWNpb25hZG98Tm9tZSBkbyB0ZXJjZWlyb3xSR1wvSUQpL2kudGVzdChzKSk7CiAgICBpZiAobGluZSkgbm9tZU9icyA9IGxpbmU7CiAgfQoKICAvLyBUcmF0YSAiTm9tZS9DYXJnbyIg4oaSIG1hbnTDqW0gYXBlbmFzIG8gbm9tZSBxdWFuZG8gYSBkaXJlaXRhIHBhcmVjZSBwYXRlbnRlL2NhcmdvCiAgaWYgKG5vbWVPYnMuaW5jbHVkZXMoIi8iKSl7CiAgICBjb25zdCBbbGVmdCxyaWdodF0gPSBub21lT2JzLnNwbGl0KCIvIikubWFwKHM9PnMudHJpbSgpKTsKICAgIGlmIChyaWdodCAmJiAvXihjYWJvfGNicG18c2d0fHNvbGRhZG98c2R8dGVufHRlbmVudGV8Y2FwfGNhcGl0fGluc3B8YWdlbnRlfGludmVzdGlnYWRvcnxvZmljaWFsKVxiL2kudGVzdChyaWdodCkpIHsKICAgICAgbm9tZU9icyA9IGxlZnQ7CiAgICB9CiAgfQoKICByZXR1cm4ge25vbWVPYnMsIG1hdE9ic307Cn0KCgogIGFzeW5jIGZ1bmN0aW9uIGZldGNoRGV0YWxoZUJ5SWRPck51bWVybyhsaXN0SXRlbSl7CiAgICBjb25zdCBhcGlPcmlnaW4gPSAoU1RBVEUubGlzdEJhc2UgPyBuZXcgVVJMKFNUQVRFLmxpc3RCYXNlKS5vcmlnaW4gOiBsb2NhdGlvbi5vcmlnaW4pOwogICAgY29uc3QgaGVhZGVycyA9IHsgIkF1dGhvcml6YXRpb24iOiBTVEFURS5hdXRoSGVhZGVyLCAiQWNjZXB0IjogImFwcGxpY2F0aW9uL2pzb24iIH07CgogICAgYXN5bmMgZnVuY3Rpb24gamdldDIodXJsKXsKICAgICAgY29uc3QgciA9IGF3YWl0IGZldGNoKHVybCwgeyBoZWFkZXJzIH0pOwogICAgICBjb25zdCBjdCA9IChyLmhlYWRlcnMuZ2V0KCJjb250ZW50LXR5cGUiKSB8fCAiIikudG9Mb3dlckNhc2UoKTsKICAgICAgY29uc3QgdHh0ID0gYXdhaXQgci50ZXh0KCk7CiAgICAgIGlmICghY3QuaW5jbHVkZXMoImpzb24iKSkgdGhyb3cgbmV3IEVycm9yKGBuw6NvLUpTT04gKCR7ci5zdGF0dXN9KWApOwogICAgICB0cnkgeyByZXR1cm4gSlNPTi5wYXJzZSh0eHQpOyB9CiAgICAgIGNhdGNoKGUpeyB0aHJvdyBuZXcgRXJyb3IoYGpzb24gaW52w6FsaWRvICgke3Iuc3RhdHVzfSlgKTsgfQogICAgfQoKICAgIGNvbnN0IGlkID0gbGlzdEl0ZW0/LmlkIHx8IGxpc3RJdGVtPy5ncnZJZCB8fCBudWxsOwogICAgaWYgKGlkICE9IG51bGwpewogICAgICByZXR1cm4gYXdhaXQgamdldDIoYCR7YXBpT3JpZ2lufS9hcGkvZ3J2LyR7aWR9P2RhZG9zRXh0cmFzPXRydWVgKTsKICAgIH0KCiAgICBjb25zdCBudW1lcm8gPSBsaXN0SXRlbT8ubnVtZXJvOwogICAgaWYgKCFudW1lcm8pIHRocm93IG5ldyBFcnJvcigic2VtIGlkIGUgc2VtIG51bWVybyIpOwogICAgY29uc3QgcXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHsgbnVtZXJvOiBTdHJpbmcobnVtZXJvKSB9KS50b1N0cmluZygpOwoKICAgIGNvbnN0IHNlYXJjaCA9IGF3YWl0IGpnZXQyKGAke2FwaU9yaWdpbn0vYXBpL2dydj8ke3FzfWApOwogICAgbGV0IGZvdW5kID0gbnVsbDsKICAgIGlmIChBcnJheS5pc0FycmF5KHNlYXJjaCkpewogICAgICBmb3VuZCA9IHNlYXJjaFswXTsKICAgIH0gZWxzZSBpZiAoc2VhcmNoICYmIHR5cGVvZiBzZWFyY2ggPT09ICJvYmplY3QiKXsKICAgICAgZm9yIChjb25zdCBrIG9mIFsiYXJyYXlEYXRhIiwiaXRlbXMiLCJkYXRhIiwicm93cyIsInJlY29yZHMiXSkgewogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHNlYXJjaFtrXSkpIHsgZm91bmQgPSBzZWFyY2hba11bMF07IGJyZWFrOyB9CiAgICAgIH0KICAgICAgaWYgKCFmb3VuZCAmJiBzZWFyY2guaWQpIGZvdW5kID0gc2VhcmNoOwogICAgfQogICAgY29uc3QgcmlkID0gZm91bmQ/LmlkIHx8IGZvdW5kPy5ncnZJZDsKICAgIGlmIChyaWQgPT0gbnVsbCkgdGhyb3cgbmV3IEVycm9yKCJuw6NvIGZvaSBwb3Nzw612ZWwgcmVzb2x2ZXIgaWQgcGVsbyBudW1lcm8iKTsKICAgIHJldHVybiBhd2FpdCBqZ2V0MihgJHthcGlPcmlnaW59L2FwaS9ncnYvJHtyaWR9P2RhZG9zRXh0cmFzPXRydWVgKTsKICB9CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PSBNQVBFQU1FTlRPIERFIExJTkhBID09PT09PT09PT09PT09PT09PT09PT09PT09ICovCiAgZnVuY3Rpb24gYmFzZVJvdyhpdGVtKXsKICAgIGNvbnN0IGNvZGUgPSBOdW1iZXIoaXRlbT8uc3RhdHVzKTsKICAgIGNvbnN0IHNpdHUgPSBzaXR1YWNhb0Zyb21TdGF0dXMoY29kZSk7CiAgICBjb25zdCBpc1JldCA9IFJFVF9TVEFUVVMuaGFzKGNvZGUpOwogICAgcmV0dXJuIFsKICAgICAgc2FmZShpdGVtPy5udW1lcm8pLAogICAgICBzYWZlKGl0ZW0/LnBsYWNhT3JpZ2luYWwpLAogICAgICBzYWZlKGl0ZW0/LnBsYWNhIHx8ICItLS0tIiksCiAgICAgIHNhZmUoaXRlbT8uY2hhc3NpKSwKICAgICAgZm10QnIoaXRlbT8uZGF0YUFwcmVlbnNhbz8uZGF0ZSB8fCBpdGVtPy5kYXRhQXByZWVuc2FvIHx8IGl0ZW0/LmFwcmVlbnNhb0RhdGEpLAogICAgICBpc1JldCA/IGZtdEJyKAogICAgICAgIGl0ZW0/LnJldGlyYWRhPy5kYXRhUmV0aXJhZGE/LmRhdGUgfHwKICAgICAgICBpdGVtPy5kYXRhUmV0aXJhZGE/LmRhdGUgfHwgaXRlbT8uZGF0YVJldGlyYWRhIHx8CiAgICAgICAgaXRlbT8uZGF0YVNhaWRhUGF0aW8/LmRhdGUgfHwgaXRlbT8uZGF0YVNhaWRhUGF0aW8gfHwKICAgICAgICBpdGVtPy5iYWl4YT8uZGF0ZSB8fCBpdGVtPy5saWJlcmFjYW8/LmRhdGUKICAgICAgKSA6ICItLS0tLSIsCiAgICAgIHNhZmUoaXRlbT8ubWFyY2EgfHwgaXRlbT8ubWFyY2FNb2RlbG8gfHwgaXRlbT8ubW9kZWxvKSwKICAgICAgc2FmZShpdGVtPy5wYXRpbz8ubm9tZSB8fCBpdGVtPy5wYXRpb05vbWUpLAogICAgICBzYWZlKGl0ZW0/LnZhZ2EpLAogICAgICBzYWZlKGl0ZW0/Lm51bWVyb0NoYXZlKSwKICAgICAgc2l0dQogICAgXTsKICB9CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IFVJIChQQUlORUwpID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCiAgbGV0IHBhbmVsLCBsb2dFbCwgYmFkZ2VUb2ssIGJhZGdlQmFzZSwgaW5TdGFydCwgaW5FbmQsIHNlbEZpbHRlciwgYnRuUnVuLCBidG5YTFNYLCBidG5Db3B5LCBidG5Db3B5TG9nOwogIGxldCBjaGtBZGRyLCBhZGRyQm94LCByYWRBcCwgcmFkUm0sIHJhZEJvdGg7CiAgbGV0IGNoa1BvbCwgcG9sQm94LCBjaGtQb2xPZmljaWFsLCBjaGtQb2xPYnM7CgogIGZ1bmN0aW9uIGJ1aWxkUGFuZWwoKXsKICAgIHBhbmVsPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgcGFuZWwuc3R5bGUuY3NzVGV4dD0icG9zaXRpb246Zml4ZWQ7cmlnaHQ6MjBweDtib3R0b206MjBweDt6LWluZGV4OjIxNDc0ODM2NDc7YmFja2dyb3VuZDojMGQxMTE3O2NvbG9yOiNlNmVkZjM7Ym9yZGVyOjFweCBzb2xpZCAjMzAzNjNkO2JvcmRlci1yYWRpdXM6MTBweDt3aWR0aDo2MTBweDtib3gtc2hhZG93OjAgOHB4IDIwcHggcmdiYSgwLDAsMCwuNTUpO2ZvbnQtZmFtaWx5OlNlZ29lIFVJLEFyaWFsLHNhbnMtc2VyaWY7Zm9udC1zaXplOjEzcHg7IjsKICAgIHBhbmVsLmlubmVySFRNTD1gCiAgICAgIDxkaXYgc3R5bGU9InBhZGRpbmc6NnB4IDEwcHg7ZGlzcGxheTpmbGV4O2dhcDo4cHg7YWxpZ24taXRlbXM6Y2VudGVyO2JvcmRlci1ib3R0b206MXB4IHNvbGlkICMzMDM2M2Q7Y3Vyc29yOm1vdmU7YmFja2dyb3VuZDojMDEwNDA5OyI+CiAgICAgICAgPGIgc3R5bGU9ImZsZXg6MTsiPkdSViBUb29scyBjb20gRW5kZXJlw6dvIGUgUG9saWNpYWwgMyBlbSAxIHYxLjQuMDwvYj4KICAgICAgICA8c3BhbiBpZD0iZ3J2X2JhZGdlX3RvayIgIHN0eWxlPSJmb250LXNpemU6MTBweDtvcGFjaXR5Oi45O21heC13aWR0aDoyMDBweDt3aGl0ZS1zcGFjZTpub3dyYXA7b3ZlcmZsb3c6aGlkZGVuO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXMiPlRva2VuOiDigJQ8L3NwYW4+CiAgICAgICAgPHNwYW4gaWQ9Imdydl9iYWRnZV9iYXNlIiBzdHlsZT0iZm9udC1zaXplOjEwcHg7b3BhY2l0eTouOTttYXgtd2lkdGg6MjYwcHg7d2hpdGUtc3BhY2U6bm93cmFwO292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzIj5CYXNlOiDigJQ8L3NwYW4+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmdyaWQ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjFmciAxZnIgMWZyO2dhcDo4cHg7cGFkZGluZzo4cHg7Ij4KICAgICAgICA8ZGl2PjxsYWJlbCBzdHlsZT0iZm9udC1zaXplOjExcHg7b3BhY2l0eTouOCI+SW7DrWNpbyAocMOhZ2luYSk8L2xhYmVsPjxpbnB1dCBpZD0iZ3J2X3N0YXJ0IiB0eXBlPSJudW1iZXIiIG1pbj0iMSIgdmFsdWU9IjEiIHN0eWxlPSJ3aWR0aDoxMDAlO2JhY2tncm91bmQ6IzBkMTExNztjb2xvcjojZTZlZGYzO2JvcmRlcjoxcHggc29saWQgIzMwMzYzZDtib3JkZXItcmFkaXVzOjZweDtwYWRkaW5nOjZweCI+PC9kaXY+CiAgICAgICAgPGRpdj48bGFiZWwgc3R5bGU9ImZvbnQtc2l6ZToxMXB4O29wYWNpdHk6LjgiPkZpbSAoMCA9IGF0w6kgemVyYXIpPC9sYWJlbD48aW5wdXQgaWQ9Imdydl9lbmQiIHR5cGU9Im51bWJlciIgbWluPSIwIiB2YWx1ZT0iNSIgc3R5bGU9IndpZHRoOjEwMCU7YmFja2dyb3VuZDojMGQxMTE3O2NvbG9yOiNlNmVkZjM7Ym9yZGVyOjFweCBzb2xpZCAjMzAzNjNkO2JvcmRlci1yYWRpdXM6NnB4O3BhZGRpbmc6NnB4Ij48L2Rpdj4KICAgICAgICA8ZGl2PgogICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXNpemU6MTFweDtvcGFjaXR5Oi44Ij5GaWx0cmFyIFNpdHVhw6fDo288L2xhYmVsPgogICAgICAgICAgPHNlbGVjdCBpZD0iZ3J2X2ZpbHRlciIgc3R5bGU9IndpZHRoOjEwMCU7YmFja2dyb3VuZDojMGQxMTE3O2NvbG9yOiNlNmVkZjM7Ym9yZGVyOjFweCBzb2xpZCAjMzAzNjNkO2JvcmRlci1yYWRpdXM6NnB4O3BhZGRpbmc6NnB4Ij48L3NlbGVjdD4KICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMHB4O29wYWNpdHk6Ljc7bWFyZ2luLXRvcDo0cHgiPlBhZHLDo28gZml4bzogIk5vIHDDoXRpbyI8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IHN0eWxlPSJwYWRkaW5nOjAgOHB4IDZweCA4cHg7Zm9udC1zaXplOjExcHg7b3BhY2l0eTouODUiPgogICAgICAgIE8gc2NyaXB0IGZvcsOnYSA8Yj4xMDAgcG9yIHDDoWdpbmE8L2I+IGUgaW5qZXRhIDxjb2RlPnN0YXR1cz08L2NvZGU+IG5hIEFQSSBjb25mb3JtZSBvIGZpbHRybyBkbyBzY3JpcHQuCiAgICAgICAgU2Ug4oCcRmlt4oCdPTUsIGEgbWV0YSDDqSBqdW50YXIgPGI+NTAwIG1hbnRpZG9zPC9iPiBwZWxvIGZpbHRybyAob3UgYXTDqSBhIGxpc3RhIHplcmFyKS4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IHN0eWxlPSJwYWRkaW5nOjhweDtib3JkZXItdG9wOjFweCBzb2xpZCAjMzAzNjNkIj4KICAgICAgICA8bGFiZWwgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjhweDtjdXJzb3I6cG9pbnRlciI+CiAgICAgICAgICA8aW5wdXQgaWQ9Imdydl9hZGRyX2VuYWJsZSIgdHlwZT0iY2hlY2tib3giPgogICAgICAgICAgPHNwYW4+SW5jbHVpciBlbmRlcmXDp288L3NwYW4+CiAgICAgICAgPC9sYWJlbD4KICAgICAgICA8ZGl2IGlkPSJncnZfYWRkcl9ib3giIHN0eWxlPSJkaXNwbGF5Om5vbmU7bWFyZ2luLXRvcDo2cHg7cGFkZGluZzo4cHg7YmFja2dyb3VuZDojMGEwZjE0O2JvcmRlcjoxcHggc29saWQgIzMwMzYzZDtib3JkZXItcmFkaXVzOjZweCI+CiAgICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjZweDtmb250LXNpemU6MTJweDtvcGFjaXR5Oi45Ij5PcmlnZW06PC9kaXY+CiAgICAgICAgICA8bGFiZWwgc3R5bGU9Im1hcmdpbi1yaWdodDoxMnB4Ij48aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9Imdydl9hZGRyX29yaWdpbiIgdmFsdWU9ImFwcmVlbnNhbyIgY2hlY2tlZD4gQXByZWVuc8OjbzwvbGFiZWw+CiAgICAgICAgICA8bGFiZWwgc3R5bGU9Im1hcmdpbi1yaWdodDoxMnB4Ij48aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9Imdydl9hZGRyX29yaWdpbiIgdmFsdWU9InJlbW9jYW8iPiBSZW1vw6fDo288L2xhYmVsPgogICAgICAgICAgPGxhYmVsPjxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0iZ3J2X2FkZHJfb3JpZ2luIiB2YWx1ZT0iYW1ib3MiPiBBbWJvczwvbGFiZWw+CiAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MTBweDtvcGFjaXR5Oi43O21hcmdpbi10b3A6NnB4Ij5MSVNUQS1vbmx5OyBjYW1wb3MgYXVzZW50ZXMgZmljYW0gIi0tLS0tIi48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IHN0eWxlPSJwYWRkaW5nOjhweDtib3JkZXItdG9wOjFweCBzb2xpZCAjMzAzNjNkIj4KICAgICAgICA8bGFiZWwgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjhweDtjdXJzb3I6cG9pbnRlciI+CiAgICAgICAgICA8aW5wdXQgaWQ9Imdydl9wb2xfZW5hYmxlIiB0eXBlPSJjaGVja2JveCI+CiAgICAgICAgICA8c3Bhbj5JbmNsdWlyIHBvbGljaWFsICh1c2EgREVUQUxIRSk8L3NwYW4+CiAgICAgICAgPC9sYWJlbD4KICAgICAgICA8ZGl2IGlkPSJncnZfcG9sX2JveCIgc3R5bGU9ImRpc3BsYXk6bm9uZTttYXJnaW4tdG9wOjZweDtwYWRkaW5nOjhweDtiYWNrZ3JvdW5kOiMwYTBmMTQ7Ym9yZGVyOjFweCBzb2xpZCAjMzAzNjNkO2JvcmRlci1yYWRpdXM6NnB4Ij4KICAgICAgICAgIDxsYWJlbCBzdHlsZT0ibWFyZ2luLXJpZ2h0OjEycHgiPjxpbnB1dCBpZD0iZ3J2X3BvbF9vZmljaWFsIiB0eXBlPSJjaGVja2JveCIgY2hlY2tlZD4gT2ZpY2lhaXMgKG5vbWUvbWF0csOtY3VsYSk8L2xhYmVsPgogICAgICAgICAgPGxhYmVsPjxpbnB1dCBpZD0iZ3J2X3BvbF9vYnMiIHR5cGU9ImNoZWNrYm94Ij4gT2JzZXJ2YcOnw6NvIChub21lL21hdHLDrWN1bGEpPC9sYWJlbD4KICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMHB4O29wYWNpdHk6Ljc7bWFyZ2luLXRvcDo2cHgiPkRFVEFMSEUgY29tIDIgd29ya2VycyBmaXhvczsgZmFsaGFzIHByZWVuY2hlbSAiLS0tLS0iIGUgc8OjbyBsb2dhZGFzLjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6OHB4O3BhZGRpbmc6OHB4O2ZsZXgtd3JhcDp3cmFwO2JvcmRlci10b3A6MXB4IHNvbGlkICMzMDM2M2QiPgogICAgICAgIDxidXR0b24gaWQ9Imdydl9ydW4iICAgc3R5bGU9ImZsZXg6MTtwYWRkaW5nOjhweDtib3JkZXItcmFkaXVzOjZweDtiYWNrZ3JvdW5kOiMyMzg2MzY7Y29sb3I6I2ZmZjtib3JkZXI6MXB4IHNvbGlkICMyZWEwNDM7Y3Vyc29yOnBvaW50ZXIiPkNhcHR1cmFyPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBpZD0iZ3J2X3hsc3giICBzdHlsZT0iZmxleDoxO3BhZGRpbmc6OHB4O2JvcmRlci1yYWRpdXM6NnB4O2JhY2tncm91bmQ6IzFmNmZlYjtjb2xvcjojZmZmO2JvcmRlcjoxcHggc29saWQgIzM4OGJmZDtjdXJzb3I6cG9pbnRlciIgZGlzYWJsZWQ+QmFpeGFyIFhMU1g8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGlkPSJncnZfY29weSIgIHN0eWxlPSJmbGV4OjE7cGFkZGluZzo4cHg7Ym9yZGVyLXJhZGl1czo2cHg7YmFja2dyb3VuZDojOWU2YzAwO2NvbG9yOiNmZmY7Ym9yZGVyOjFweCBzb2xpZCAjYjg4NDAwO2N1cnNvcjpwb2ludGVyIiBkaXNhYmxlZD5Db3BpYXIgVFNWPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBpZD0iZ3J2X2NvcHlfbG9nIiBzdHlsZT0iZmxleDoxO3BhZGRpbmc6OHB4O2JvcmRlci1yYWRpdXM6NnB4O2JhY2tncm91bmQ6IzZlNzY4MTtjb2xvcjojMGQxMTE3O2JvcmRlcjoxcHggc29saWQgIzhiOTQ5ZTtjdXJzb3I6cG9pbnRlciI+Q29waWFyIExvZzwvYnV0dG9uPgogICAgICA8L2Rpdj4KCiAgICAgIDx0ZXh0YXJlYSBpZD0iZ3J2X2xvZyIgcmVhZG9ubHkgc3R5bGU9IndpZHRoOmNhbGMoMTAwJSAtIDE2cHgpO21hcmdpbjowIDhweCA4cHg7aGVpZ2h0OjI0MHB4O2JhY2tncm91bmQ6IzBhMGYxNDtjb2xvcjojZDFmN2M0O2JvcmRlcjoxcHggc29saWQgIzMwMzYzZDtib3JkZXItcmFkaXVzOjZweDtyZXNpemU6dmVydGljYWw7Zm9udC1mYW1pbHk6dWktbW9ub3NwYWNlLENvbnNvbGFzLE1lbmxvLG1vbm9zcGFjZTtmb250LXNpemU6MTJweDtwYWRkaW5nOjhweCI+PC90ZXh0YXJlYT4KICAgIGA7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHBhbmVsKTsKCiAgICAvLyBhcnJhc3RhciBwYWluZWwKICAgIGNvbnN0IGhlYWQ9cGFuZWwuZmlyc3RFbGVtZW50Q2hpbGQ7IGxldCBzeD0wLHN5PTAsb3g9MCxveT0wLGRyYWc9ZmFsc2U7CiAgICBoZWFkLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZG93biIsZT0+e2RyYWc9dHJ1ZTtzeD1lLmNsaWVudFg7c3k9ZS5jbGllbnRZO2NvbnN0IHI9cGFuZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7b3g9ci5sZWZ0O295PXIudG9wO30pOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsZT0+eyBpZighZHJhZykgcmV0dXJuOyBwYW5lbC5zdHlsZS5sZWZ0PShveCtlLmNsaWVudFgtc3gpKyJweCI7IHBhbmVsLnN0eWxlLnRvcD0ob3krZS5jbGllbnRZLXN5KSsicHgiOyBwYW5lbC5zdHlsZS5yaWdodD0iYXV0byI7IHBhbmVsLnN0eWxlLmJvdHRvbT0iYXV0byI7IH0pOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNldXAiLCgpPT5kcmFnPWZhbHNlKTsKCiAgICAvLyByZWZzCiAgICBsb2dFbCAgICAgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCIjZ3J2X2xvZyIpOwogICAgYmFkZ2VUb2sgID0gcGFuZWwucXVlcnlTZWxlY3RvcigiI2dydl9iYWRnZV90b2siKTsKICAgIGJhZGdlQmFzZSA9IHBhbmVsLnF1ZXJ5U2VsZWN0b3IoIiNncnZfYmFkZ2VfYmFzZSIpOwogICAgaW5TdGFydCAgID0gcGFuZWwucXVlcnlTZWxlY3RvcigiI2dydl9zdGFydCIpOwogICAgaW5FbmQgICAgID0gcGFuZWwucXVlcnlTZWxlY3RvcigiI2dydl9lbmQiKTsKICAgIHNlbEZpbHRlciA9IHBhbmVsLnF1ZXJ5U2VsZWN0b3IoIiNncnZfZmlsdGVyIik7CiAgICBidG5SdW4gICAgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCIjZ3J2X3J1biIpOwogICAgYnRuWExTWCAgID0gcGFuZWwucXVlcnlTZWxlY3RvcigiI2dydl94bHN4Iik7CiAgICBidG5Db3B5ICAgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCIjZ3J2X2NvcHkiKTsKICAgIGJ0bkNvcHlMb2c9IHBhbmVsLnF1ZXJ5U2VsZWN0b3IoIiNncnZfY29weV9sb2ciKTsKCiAgICBjaGtBZGRyICAgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCIjZ3J2X2FkZHJfZW5hYmxlIik7CiAgICBhZGRyQm94ICAgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCIjZ3J2X2FkZHJfYm94Iik7CiAgICByYWRBcCAgICAgPSBhZGRyQm94LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3ZhbHVlPSJhcHJlZW5zYW8iXScpOwogICAgcmFkUm0gICAgID0gYWRkckJveC5xdWVyeVNlbGVjdG9yKCdpbnB1dFt2YWx1ZT0icmVtb2NhbyJdJyk7CiAgICByYWRCb3RoICAgPSBhZGRyQm94LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3ZhbHVlPSJhbWJvcyJdJyk7CgogICAgY2hrUG9sICAgID0gcGFuZWwucXVlcnlTZWxlY3RvcigiI2dydl9wb2xfZW5hYmxlIik7CiAgICBwb2xCb3ggICAgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCIjZ3J2X3BvbF9ib3giKTsKICAgIGNoa1BvbE9maWNpYWwgPSBwb2xCb3gucXVlcnlTZWxlY3RvcigiI2dydl9wb2xfb2ZpY2lhbCIpOwogICAgY2hrUG9sT2JzICAgICA9IHBvbEJveC5xdWVyeVNlbGVjdG9yKCIjZ3J2X3BvbF9vYnMiKTsKCiAgICAvLyBwb3B1bGEgZmlsdHJvIChwYWRyw6NvIGZpeG86IOKAnE5vIHDDoXRpb+KAnSkKICAgIGZvciAoY29uc3QgW3ZhbCxsYWJlbF0gb2YgRklMVEVSX09QVElPTlMpewogICAgICBjb25zdCBvcHQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7IG9wdC52YWx1ZT12YWw7IG9wdC50ZXh0Q29udGVudD1sYWJlbDsKICAgICAgc2VsRmlsdGVyLmFwcGVuZENoaWxkKG9wdCk7CiAgICB9CiAgICBzZWxGaWx0ZXIudmFsdWUgPSAiMSI7CgogICAgLy8gZXZlbnRvcwogICAgYnRuUnVuLm9uY2xpY2sgID0gb25SdW47CiAgICBidG5YTFNYLm9uY2xpY2sgPSBkb3dubG9hZFhMU1g7CiAgICBidG5Db3B5Lm9uY2xpY2sgPSBjb3B5VFNWOwogICAgYnRuQ29weUxvZy5vbmNsaWNrID0gKCk9Pm5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGxvZ0VsLnZhbHVlKS50aGVuKCgpPT5sb2coIkxvZyBjb3BpYWRvLiIpLCgpPT5sb2coIkZhbGhhIGFvIGNvcGlhciBsb2cuIikpOwoKICAgIGNoa0FkZHIuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKCk9PnsgYWRkckJveC5zdHlsZS5kaXNwbGF5ID0gY2hrQWRkci5jaGVja2VkID8gImJsb2NrIiA6ICJub25lIjsgfSk7CiAgICBjaGtQb2wuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgICgpPT57IHBvbEJveC5zdHlsZS5kaXNwbGF5ICA9IGNoa1BvbC5jaGVja2VkICA/ICJibG9jayIgOiAibm9uZSI7IH0pOwoKICAgIHVwZGF0ZUJhZGdlcygpOwogICAgc2V0VGltZW91dCh0cnlQZXJmLCAyNTApOwogIH0KCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PSBDQUJFw4dBTEhPIERJTsOCTUlDTyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCiAgZnVuY3Rpb24gYnVpbGRIZWFkZXIoaW5jbHVkZUFkZHIsIG9yaWdpbiwgcG9sT24sIHBvbE9mLCBwb2xPYnMpewogICAgY29uc3QgYmFzZSA9IFsiR1JWIiwiUGxhY2EgT3JpZ2luYWwiLCJQbGFjYSBPc3RlbnRhZGEiLCJDaGFzc2kiLCJEYXRhIGRhIEFwcmVlbnPDo28iLCJEYXRhIGRhIFJldGlyYWRhIiwiTWFyY2EvTW9kZWxvIiwiUMOhdGlvIiwiVmFnYSIsIk7CuiBkYSBDaGF2ZSIsIlNpdHVhw6fDo28iXTsKICAgIGNvbnN0IG91dCA9IGJhc2Uuc2xpY2UoKTsKICAgIGlmIChpbmNsdWRlQWRkcil7CiAgICAgIGNvbnN0IGFwID0gWyJMb2dyYWRvdXJvIChhcHJlZW5zw6NvKSIsIkJhaXJybyAoYXByZWVuc8OjbykiLCJDaWRhZGUgKGFwcmVlbnPDo28pIiwiVUYgKGFwcmVlbnPDo28pIiwiQ29tcGxlbWVudG8gKGFwcmVlbnPDo28pIl07CiAgICAgIGNvbnN0IHJtID0gWyJMb2dyYWRvdXJvIChyZW1vw6fDo28pIiwiQmFpcnJvIChyZW1vw6fDo28pIiwiQ2lkYWRlIChyZW1vw6fDo28pIiwiVUYgKHJlbW/Dp8OjbykiLCJDb21wbGVtZW50byAocmVtb8Onw6NvKSJdOwogICAgICBpZiAob3JpZ2luPT09ImFwcmVlbnNhbyIpIG91dC5wdXNoKC4uLmFwKTsKICAgICAgZWxzZSBpZiAob3JpZ2luPT09InJlbW9jYW8iKSBvdXQucHVzaCguLi5ybSk7CiAgICAgIGVsc2Ugb3V0LnB1c2goLi4uYXAsIC4uLnJtKTsKICAgIH0KICAgIGlmIChwb2xPbil7CiAgICAgIGlmIChwb2xPZil7IG91dC5wdXNoKCJQb2xpY2lhbCBhcHJlZW5zb3IiLCJNYXRyw61jdWxhIik7IH0KICAgICAgaWYgKHBvbE9icyl7IG91dC5wdXNoKCJQb2xpY2lhbCBhcHJlZW5zb3IgKG9ic2VydmHDp8OjbykiLCJNYXRyw61jdWxhIChvYnNlcnZhw6fDo28pIik7IH0KICAgIH0KICAgIHJldHVybiBvdXQ7CiAgfQogIGZ1bmN0aW9uIGFwcGVuZEFkZHJlc3NJZk5lZWRlZChyb3csIGl0ZW0sIGluY2x1ZGVBZGRyLCBvcmlnaW4pewogICAgaWYgKCFpbmNsdWRlQWRkcikgcmV0dXJuIHJvdzsKICAgIGlmIChvcmlnaW49PT0iYXByZWVuc2FvIikgcmV0dXJuIHJvdy5jb25jYXQocGlja0VuZGVyZWNvRnJvbUxpc3QoaXRlbSwiYXByZWVuc2FvIikpOwogICAgaWYgKG9yaWdpbj09PSJyZW1vY2FvIikgICByZXR1cm4gcm93LmNvbmNhdChwaWNrRW5kZXJlY29Gcm9tTGlzdChpdGVtLCJyZW1vY2FvIikpOwogICAgcmV0dXJuIHJvdy5jb25jYXQocGlja0VuZGVyZWNvRnJvbUxpc3QoaXRlbSwiYXByZWVuc2FvIiksIHBpY2tFbmRlcmVjb0Zyb21MaXN0KGl0ZW0sInJlbW9jYW8iKSk7CiAgfQoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gQ09SRSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KICBhc3luYyBmdW5jdGlvbiBvblJ1bigpewogICAgaWYgKCFTVEFURS5hdXRoSGVhZGVyKXsgbG9nKCJFUlJPOiB0b2tlbiBuw6NvIGNhcHR1cmFkby4iKTsgcmV0dXJuOyB9CiAgICBpZiAoIVNUQVRFLmxpc3RCYXNlKXsgdHJ5UGVyZigpOyB9CiAgICBpZiAoIVNUQVRFLmxpc3RCYXNlKXsgbG9nKCJFUlJPOiBiYXNlIGRhIGxpc3RhIG7Do28gZGV0ZWN0YWRhLiBOYXZlZ3VlIDEgcMOhZ2luYSBvdSBzZWxlY2lvbmUgMTAwIHBvciBww6FnaW5hLiIpOyByZXR1cm47IH0KCiAgICBjb25zdCBzdGFydCA9IE1hdGgubWF4KDEsIHBhcnNlSW50KGluU3RhcnQudmFsdWV8fCIxIiwxMCkpOwogICAgY29uc3QgZW5kICAgPSBNYXRoLm1heCgwLCBwYXJzZUludChpbkVuZC52YWx1ZXx8IjUiLDEwKSk7CiAgICBjb25zdCBmaWx0ZXJWYWx1ZSA9IHNlbEZpbHRlci52YWx1ZSB8fCAiMSI7IC8vIGRlZmF1bHQgTm8gcMOhdGlvCgogICAgY29uc3QgaW5jbHVkZUFkZHIgPSAhIWNoa0FkZHIuY2hlY2tlZDsKICAgIGNvbnN0IG9yaWdpbiA9IGluY2x1ZGVBZGRyID8gKHJhZEFwLmNoZWNrZWQgPyAiYXByZWVuc2FvIiA6IChyYWRSbS5jaGVja2VkID8gInJlbW9jYW8iIDogImFtYm9zIikpIDogImFwcmVlbnNhbyI7CgogICAgY29uc3QgaW5jbHVkZVBvbCA9ICEhY2hrUG9sLmNoZWNrZWQ7CiAgICBjb25zdCBwb2xPZiA9IGluY2x1ZGVQb2wgJiYgISFjaGtQb2xPZmljaWFsLmNoZWNrZWQ7CiAgICBjb25zdCBwb2xPYnMgPSBpbmNsdWRlUG9sICYmICEhY2hrUG9sT2JzLmNoZWNrZWQ7CgogICAgY29uc3QgZmlsdGVyTGFiZWwgPSBGSUxURVJfT1BUSU9OUy5maW5kKGY9PmZbMF09PT1maWx0ZXJWYWx1ZSk/LlsxXSB8fCBmaWx0ZXJWYWx1ZTsKICAgIGNvbnN0IGFkZHJMYWJlbCA9IGluY2x1ZGVBZGRyID8gb3JpZ2luIDogIm7Do28iOwogICAgY29uc3QgcG9sTGFiZWwgID0gaW5jbHVkZVBvbCA/IChgb2ZpY2lhaXM9JHtwb2xPZj8ic2ltIjoibsOjbyJ9OyBvYnM9JHtwb2xPYnM/InNpbSI6Im7Do28ifWApIDogIm7Do28iOwogICAgbG9nKGBJbsOtY2lvOiAke3N0YXJ0fSB8IEZpbTogJHtlbmR8fCJhdMOpIHplcmFyIn0gfCBGaWx0cm8gKHNjcmlwdC9BUEkpOiAke2ZpbHRlckxhYmVsfSB8IEVuZGVyZcOnbzogJHthZGRyTGFiZWx9IHwgUG9saWNpYWw6ICR7cG9sTGFiZWx9YCk7CiAgICBsb2coYEJhc2UgdXNhZGE6ICR7U1RBVEUubGlzdEJhc2V9YCk7CiAgICBpZiAoZW5kPjApIGxvZyhgTWV0YTogJHtlbmQqMTAwfSBtYW50aWRvcyBwZWxvIGZpbHRyby5gKTsKCiAgICBjb25zdCBoZWFkZXIgPSBidWlsZEhlYWRlcihpbmNsdWRlQWRkciwgb3JpZ2luLCBpbmNsdWRlUG9sLCBwb2xPZiwgcG9sT2JzKTsKICAgIGNvbnN0IGFvYSA9IFtoZWFkZXJdOwoKICAgIGNvbnN0IHRhcmdldEtlcHQgPSBlbmQgPiAwID8gKGVuZCAqIDEwMCkgOiBudWxsOwoKICAgIGxldCBwYWdlPXN0YXJ0LHRvdGFsPTAsa2VwdD0wLGVtcHR5PTA7CiAgICBjb25zdCB0YXNrcyA9IFtdOyAvLyBmaWxhIGRlIGRldGFsaGVzIOKGkiB7cm93SW5kZXgsIGl0ZW19CgogICAgd2hpbGUodHJ1ZSl7CiAgICAgIGlmICh0YXJnZXRLZXB0ICE9IG51bGwgJiYga2VwdCA+PSB0YXJnZXRLZXB0KSBicmVhazsgICAvLyBqw6EgYXRpbmdpdSBOw5cxMDAgbWFudGlkb3MKCiAgICAgIGxvZyhg4oaSIFDDoWdpbmEgJHtwYWdlfeKApmApOwogICAgICBsZXQgaXRlbXM9W107CiAgICAgIHRyeXsgaXRlbXMgPSBhd2FpdCBnZXRMaXN0UGFnZShTVEFURS5saXN0QmFzZSwgcGFnZSwgZmlsdGVyVmFsdWUpOyB9CiAgICAgIGNhdGNoKGUpeyBsb2coYEVSUk8gQVBJOiAke2UgJiYgZS5tZXNzYWdlIHx8IGV9YCk7IGJyZWFrOyB9CgogICAgICBpZiAoIWl0ZW1zIHx8IGl0ZW1zLmxlbmd0aD09PTApewogICAgICAgIGxvZyhgUMOhZ2luYSAke3BhZ2V9OiAwIGl0ZW5zLmApOwogICAgICAgIGVtcHR5Kys7CiAgICAgICAgLy8gRmltPTA6IHZhcnJlIGF0w6kg4oCcemVyYXLigJ0gKHByaW1laXJhIHZhemlhKS4KICAgICAgICAvLyBGaW0+MDogYWNhYm91IGEgbGlzdGEgYW50ZXMgZGEgbWV0YSDigJQgcGFyYW1vcy4KICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgZW1wdHk9MDsKICAgICAgbGV0IGtlcHRUaGlzUGFnZSA9IDA7CiAgICAgIGZvciAoY29uc3QgaXQgb2YgaXRlbXMpewogICAgICAgIC8vIERlZmVzYTogbWVzbW8gZmlsdHJhbmRvIG5hIEFQSSwgbWFudGVtb3MgbyBmaWx0cm8gbG9jYWwKICAgICAgICBjb25zdCBjb2RlID0gTnVtYmVyKGl0Py5zdGF0dXMpOwogICAgICAgIGlmICghcGFzc0ZpbHRlcihjb2RlLCBmaWx0ZXJWYWx1ZSkpIGNvbnRpbnVlOwoKICAgICAgICBjb25zdCBiYXNlID0gYmFzZVJvdyhpdCk7CiAgICAgICAgY29uc3Qgd2l0aEFkZHIgPSBhcHBlbmRBZGRyZXNzSWZOZWVkZWQoYmFzZSwgaXQsIGluY2x1ZGVBZGRyLCBvcmlnaW4pOwoKICAgICAgICBjb25zdCByb3dJbmRleCA9IGFvYS5sZW5ndGg7CiAgICAgICAgYW9hLnB1c2god2l0aEFkZHIpOwogICAgICAgIGtlcHQrKzsga2VwdFRoaXNQYWdlKys7CgogICAgICAgIGlmIChpbmNsdWRlUG9sICYmIChwb2xPZiB8fCBwb2xPYnMpKXsKICAgICAgICAgIHRhc2tzLnB1c2goe3Jvd0luZGV4LCBpdGVtOiBpdH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhcmdldEtlcHQgIT0gbnVsbCAmJiBrZXB0ID49IHRhcmdldEtlcHQpIGJyZWFrOwogICAgICB9CiAgICAgIHRvdGFsICs9IGl0ZW1zLmxlbmd0aDsKICAgICAgbG9nKGDinJMgJHtpdGVtcy5sZW5ndGh9IGl0ZW5zIHJlY2ViaWRvczsgbWFudGlkb3MgbmVzdGEgcMOhZ2luYTogJHtrZXB0VGhpc1BhZ2V9OyBtYW50aWRvcyBhY3VtdWxhZG9zOiAke2tlcHR9LmApOwoKICAgICAgaWYgKHRhcmdldEtlcHQgIT0gbnVsbCAmJiBrZXB0ID49IHRhcmdldEtlcHQpIGJyZWFrOwogICAgICBwYWdlKys7IGF3YWl0IHNsZWVwKDMwKTsKICAgIH0KCiAgICBpZiAoaW5jbHVkZVBvbCAmJiAocG9sT2YgfHwgcG9sT2JzKSAmJiB0YXNrcy5sZW5ndGg+MCl7CiAgICAgIGxvZyhgW3BvbGljaWFsXSBpbmljaWFuZG8gZGV0YWxoZSBwYXJhICR7dGFza3MubGVuZ3RofSBsaW5oYShzKSAoMiB3b3JrZXJzKWApOwogICAgICBhd2FpdCBydW5EZXRhaWxXb3JrZXJzKHRhc2tzLCBhb2EsIHtwb2xPZiwgcG9sT2JzfSk7CiAgICB9CgogICAgU1RBVEUucm93c0FPQSA9IGFvYTsKICAgIGJ0blhMU1guZGlzYWJsZWQgPSBmYWxzZTsKICAgIGJ0bkNvcHkuZGlzYWJsZWQgPSBmYWxzZTsKICAgIGxvZyhgQ29uY2x1w61kby4gSXRlbnMgcmVjZWJpZG9zIChicnV0b3MpOiAke3RvdGFsfS4gTGluaGFzIGV4cG9ydMOhdmVpcyAocMOzcy1maWx0cm8pOiAke2FvYS5sZW5ndGgtMX0uYCk7CiAgfQoKICAvLyAyIHdvcmtlcnMgZml4b3MsIGNvbSByZXRyaWVzIGxldmVzIGUgYmFja29mZgogIGFzeW5jIGZ1bmN0aW9uIHJ1bkRldGFpbFdvcmtlcnModGFza3MsIGFvYSwgb3B0cyl7CiAgICBjb25zdCB7cG9sT2YsIHBvbE9ic30gPSBvcHRzOwogICAgbGV0IGlkeCA9IDA7CiAgICBjb25zdCBuZXh0ID0gKCk9PiAoaWR4IDwgdGFza3MubGVuZ3RoKSA/IHRhc2tzW2lkeCsrXSA6IG51bGw7CgogICAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hXaXRoUmV0cnkoam9iKXsKICAgICAgY29uc3QgTUFYID0gMzsKICAgICAgZm9yIChsZXQgYT0xOyBhPD1NQVg7IGErKyl7CiAgICAgICAgdHJ5IHsgcmV0dXJuIGF3YWl0IGZldGNoRGV0YWxoZUJ5SWRPck51bWVybyhqb2IuaXRlbSk7IH0KICAgICAgICBjYXRjaChlKXsKICAgICAgICAgIGlmIChhPT09TUFYKSB0aHJvdyBlOwogICAgICAgICAgY29uc3Qgd2FpdCA9IDQwMCAqIGE7IC8vIDAuNHMsIDAuOHMsIDEuMnMKICAgICAgICAgIGF3YWl0IHNsZWVwKHdhaXQpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGFzeW5jIGZ1bmN0aW9uIHdvcmtlcihpZCl7CiAgICAgIHdoaWxlKHRydWUpewogICAgICAgIGNvbnN0IGpvYiA9IG5leHQoKTsKICAgICAgICBpZiAoIWpvYikgYnJlYWs7CiAgICAgICAgdHJ5ewogICAgICAgICAgY29uc3QgZGV0ID0gYXdhaXQgZmV0Y2hXaXRoUmV0cnkoam9iKTsKICAgICAgICAgIGNvbnN0IGNvbHMgPSBbXTsKICAgICAgICAgIGlmIChwb2xPZil7CiAgICAgICAgICAgIGNvbnN0IHtub21lLCBtYXR9ID0gZ2V0UG9saWNpYWxPZmljaWFsRnJvbURldGFsaGUoZGV0KTsKICAgICAgICAgICAgY29scy5wdXNoKHNhZmUobm9tZSksIHNhZmUobWF0KSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocG9sT2JzKXsKICAgICAgICAgICAgY29uc3Qgb2JzID0gZGV0Py5vYnNlcnZhY29lcyB8fCBkZXQ/Lm9ic2VydmFjYW8gfHwgZGV0Py5vYnNlcnZhY29lc1ZlaWN1bG8gfHwgIiI7CiAgICAgICAgICAgIGNvbnN0IHtub21lT2JzLCBtYXRPYnN9ID0gcGFyc2VQb2xpY2lhbEZyb21PYnNlcnZhY2FvKG9icyk7CiAgICAgICAgICAgIGNvbHMucHVzaChzYWZlKG5vbWVPYnMpLCBzYWZlKG1hdE9icykpOwogICAgICAgICAgfQogICAgICAgICAgYW9hW2pvYi5yb3dJbmRleF0gPSBhb2Fbam9iLnJvd0luZGV4XS5jb25jYXQoY29scyk7CiAgICAgICAgfSBjYXRjaChlKXsKICAgICAgICAgIGxvZyhgW3BvbGljaWFsXSBmYWxoYSAoJHtlICYmIGUubWVzc2FnZSB8fCBlfSkgZW0gR1JWICR7am9iLml0ZW0/Lm51bWVybyB8fCAiPyJ9YCk7CiAgICAgICAgICBjb25zdCBjb2xzID0gW107CiAgICAgICAgICBpZiAocG9sT2YpIGNvbHMucHVzaCgiLS0tLS0iLCItLS0tLSIpOwogICAgICAgICAgaWYgKHBvbE9icykgY29scy5wdXNoKCItLS0tLSIsIi0tLS0tIik7CiAgICAgICAgICBhb2Fbam9iLnJvd0luZGV4XSA9IGFvYVtqb2Iucm93SW5kZXhdLmNvbmNhdChjb2xzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGF3YWl0IFByb21pc2UuYWxsKFt3b3JrZXIoMSksIHdvcmtlcigyKV0pOwogIH0KCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gRVhQT1JUUyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwogIGZ1bmN0aW9uIGRvd25sb2FkWExTWCgpewogICAgaWYoIVNUQVRFLnJvd3NBT0EpeyBsb2coIk5hZGEgcGFyYSBleHBvcnRhci4iKTsgcmV0dXJuOyB9CiAgICBpZighKHdpbmRvdy5YTFNYICYmIFhMU1gudXRpbHMpKXsgbG9nKCJBZ3VhcmRlIG8gbcOzZHVsbyBYTFNYIGNhcnJlZ2FyIGUgdGVudGUgZGUgbm92by4iKTsgcmV0dXJuOyB9CiAgICBjb25zdCB3cyA9IFhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KFNUQVRFLnJvd3NBT0EpOwogICAgY29uc3Qgd2IgPSBYTFNYLnV0aWxzLmJvb2tfbmV3KCk7CiAgICBYTFNYLnV0aWxzLmJvb2tfYXBwZW5kX3NoZWV0KHdiLCB3cywgIkdSViIpOwogICAgY29uc3Qgd2JvdXQgPSBYTFNYLndyaXRlKHdiLCB7Ym9va1R5cGU6Inhsc3giLCB0eXBlOiJhcnJheSJ9KTsKICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbd2JvdXRdLCB7dHlwZToiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIn0pOwogICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgIGEuaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICBhLmRvd25sb2FkID0gYGdydl9saXN0YV8ke3RzKCl9Lnhsc3hgOwogICAgYS5jbGljaygpOyBzZXRUaW1lb3V0KCgpPT5VUkwucmV2b2tlT2JqZWN0VVJMKGEuaHJlZiksIDQwMCk7CiAgfQoKICBhc3luYyBmdW5jdGlvbiBjb3B5VFNWKCl7CiAgICBpZighU1RBVEUucm93c0FPQSl7IGxvZygiTmFkYSBwYXJhIGNvcGlhci4iKTsgcmV0dXJuOyB9CiAgICBjb25zdCBzYW5pdGl6ZUZvclRTViA9ICh2KSA9PiB7CiAgICAgIGlmICh2ID09IG51bGwpIHJldHVybiAiIjsKICAgICAgcmV0dXJuIFN0cmluZyh2KQogICAgICAgIC5yZXBsYWNlKC9ccj9cbi9nLCAiICIpICAgLy8gXG4g4oaSIGVzcGHDp28KICAgICAgICAucmVwbGFjZSgvXHQvZywgIiAiKSAgICAgIC8vIFx0IOKGkiBlc3Bhw6dvCiAgICAgICAgLnJlcGxhY2UoL1x1MDBBMC9nLCAiICIpICAvLyBOQlNQIOKGkiBlc3Bhw6dvCiAgICAgICAgLnJlcGxhY2UoL1xzezIsfS9nLCAiICIpICAvLyBjb21wYWN0YQogICAgICAgIC50cmltKCk7CiAgICB9OwogICAgY29uc3QgdHN2ID0gU1RBVEUucm93c0FPQS5tYXAocm93ID0+IHJvdy5tYXAoc2FuaXRpemVGb3JUU1YpLmpvaW4oIlx0IikpLmpvaW4oIlxyXG4iKTsKICAgIHRyeSB7CiAgICAgIGlmIChuYXZpZ2F0b3IuY2xpcGJvYXJkICYmIHdpbmRvdy5DbGlwYm9hcmRJdGVtKSB7CiAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFt0c3ZdLCB7IHR5cGU6ICJ0ZXh0L3RhYi1zZXBhcmF0ZWQtdmFsdWVzIiB9KTsKICAgICAgICBjb25zdCBpdGVtID0gbmV3IENsaXBib2FyZEl0ZW0oeyAidGV4dC90YWItc2VwYXJhdGVkLXZhbHVlcyI6IGJsb2IsICJ0ZXh0L3BsYWluIjogYmxvYiB9KTsKICAgICAgICBhd2FpdCBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlKFtpdGVtXSk7CiAgICAgICAgbG9nKCJDb3BpYWRvIChUU1YpLiBDb2xlIG5vIEdvb2dsZSBTaGVldHMvRXhjZWwuIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9IGNhdGNoIHt9CiAgICB0cnkgewogICAgICBpZiAobmF2aWdhdG9yLmNsaXBib2FyZCAmJiBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCkgewogICAgICAgIGF3YWl0IG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KHRzdik7CiAgICAgICAgbG9nKCJDb3BpYWRvIChUU1YpLiBDb2xlIG5vIEdvb2dsZSBTaGVldHMvRXhjZWwuIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9IGNhdGNoIHt9CiAgICB0cnkgewogICAgICBjb25zdCB0YT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpOwogICAgICB0YS5zdHlsZS5wb3NpdGlvbj0iZml4ZWQiOyB0YS5zdHlsZS5sZWZ0PSItOTk5OXB4IjsgdGEudmFsdWU9dHN2OwogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRhKTsKICAgICAgdGEuZm9jdXMoKTsgdGEuc2VsZWN0KCk7CiAgICAgIGNvbnN0IG9rPWRvY3VtZW50LmV4ZWNDb21tYW5kKCJjb3B5Iik7CiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGEpOwogICAgICBsb2cob2sgPyAiQ29waWFkbyAoVFNWKS4gQ29sZSBubyBHb29nbGUgU2hlZXRzL0V4Y2VsLiIKICAgICAgICAgICAgIDogIkZhbGhhIGFvIGNvcGlhci4gU2VsZWNpb25lIGUgY29waWUgbWFudWFsbWVudGUuIik7CiAgICB9IGNhdGNoIHsKICAgICAgbG9nKCJGYWxoYSBhbyBjb3BpYXIuIFNlbGVjaW9uZSBlIGNvcGllIG1hbnVhbG1lbnRlLiIpOwogICAgfQogIH0KCiAgLy8gU2hlZXRKUyBwYXJhIFhMU1gKICBjb25zdCBzPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogIHMuc3JjPSJodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy94bHN4LzAuMTguNS94bHN4LmZ1bGwubWluLmpzIjsKICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHMpOwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gQk9PVCA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KICBmdW5jdGlvbiBib290KCl7CiAgICBpZiAoZG9jdW1lbnQuYm9keSkgYnVpbGRQYW5lbCgpOwogICAgZWxzZSB7CiAgICAgIGNvbnN0IG1vPW5ldyBNdXRhdGlvbk9ic2VydmVyKCgpPT57IGlmKGRvY3VtZW50LmJvZHkpeyBtby5kaXNjb25uZWN0KCk7IGJ1aWxkUGFuZWwoKTsgfSB9KTsKICAgICAgbW8ub2JzZXJ2ZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnR8fGRvY3VtZW50LCB7Y2hpbGRMaXN0OnRydWUsc3VidHJlZTp0cnVlfSk7CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgKCk9PnsgaWYoIXBhbmVsKSBidWlsZFBhbmVsKCk7IH0sIHtvbmNlOnRydWV9KTsKICAgIH0KICB9CiAgYm9vdCgpOwp9KSgpOw==";(0,eval)((typeof atob==='function'?atob:d=>decodeURIComponent(escape(
(function(b){
const c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';let s='',i=0,e1,e2,e3,e4,ch1,ch2,ch3;
b=b.replace(/[^A-Za-z0-9\+\/\=]/g,'');
while(i<b.length){e1=c.indexOf(b.charAt(i++));e2=c.indexOf(b.charAt(i++));e3=c.indexOf(b.charAt(i++));e4=c.indexOf(b.charAt(i++));
ch1=(e1<<2)|(e2>>4);ch2=((e2&15)<<4)|(e3>>2);ch3=((e3&3)<<6)|e4;
s+=String.fromCharCode(ch1);if(e3!=64)s+=String.fromCharCode(ch2);if(e4!=64)s+=String.fromCharCode(ch3);}
return s;})(d)))));})();
