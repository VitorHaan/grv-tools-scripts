// ==UserScript==
// @name         GRV Tools com Endereço e Policial 3 em 1 v1.4.3 (obfuscated)
// @namespace    vitor.grv.tools (obfuscated)
// @version      1.4.3
// @description  LISTA (canônica) + ENDEREÇO (Apreensão/Remoção/Ambos – opcional) + POLICIAL (opcional, via DETALHE). Situação por status, datas sem .000000. Exporta XLSX/TSV. UI aprovada (padrão: filtro "No pátio"; páginas 1→5; sem atalhos). Força 100 por página, aplica filtro de Situação JÁ NA API e coleta exatamente N×100 mantidos.
// @match        https://intranet.consorciorioparkingcarioca.com/*
// @run-at       document-start
// @grant        none
// ==/UserScript==

(function(){'use strict';
  // Empacotado em Base64 (UTF-8 safe).
  const b = "LyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgR1JWIFRvb2xzIOKAlCAzIGVtIDEgKExpc3RhICsgRW5kZXJlw6dvICsgUG9saWNpYWwpCgogICDilrogQ0hBTkdFTE9HIChyZXN1bW8gcmVsZXZhbnRlKQogICAgIHYxLjQuMyAoZXN0ZSBhcnF1aXZvKQogICAgICAg4oCiIOKtkCBOT1ZPOiBib3TDo28gTWluaW1pemFyL1Jlc3RhdXJhciBubyBjYWJlw6dhbGhvICh0YW1iw6ltIHBvciBkdXBsby1jbGlxdWUpLgogICAgICAg4oCiIOKtkCBOT1ZPOiBSZWRpbWVuc2lvbmFtZW50byBwZWxhcyBib3JkYXMgKEUvRC9DaW1hL0JhaXhvKSBjb20gbGltaXRlcy4KICAgICAgIOKAoiBSZXN0YW50ZSBkbyBmbHV4byBpbmFsdGVyYWRvIChjb2xldGEsIGZpbHRyb3MsIGV4cG9ydGHDp8O1ZXMsIFVJIGUgbGF5b3V0KS4KCiAgICAgdjEuNC4wCiAgICAgICDigKIgRmlsdHJvIHBvciBTaXR1YcOnw6NvIGFwbGljYWRvIE5PIFNFUlZJRE9SIChBUEkpLgogICAgICAg4oCiIE1ldGEgZGUgbWFudGlkb3MgKEZpbT1OIOKHkiBqdW50YSBOw5cxMDAgbWFudGlkb3MpLgogICAgICAg4oCiIEZvcsOnYSAxMDAgcG9yIHDDoWdpbmEgKGxpbWl0L3BlclBhZ2UvcGFnZVNpemUvc2l6ZSA9IDEwMCkuCgogICAgIHYxLjMuMAogICAgICAg4oCiIChvYnNvbGV0bykgbWV0YSBkZSBtYW50aWRvcyBjb2V4aXN0aWEgY29tIGxpbWl0ZSBkZSDigJxww6FnaW5hcyBjcnVhc+KAnS4KCiAgICAgdjEuMi4wCiAgICAgICDigKIgVFNWIGVzdMOhdmVsIChzYW5pdGl6YcOnw6NvIFxuLCBcdCwgTkJTUCkuCiAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogICDimpbvuI8gU2l0dWHDp8OjbyDigJQgcmVncmEgY2Fuw7RuaWNhIChTRU0gVEVYVE8gZGEgVUkhKQogICDigKIgRm9udGUgZGEgdmVyZGFkZTogc3RhdHVzIG51bcOpcmljbyBkYSBMSVNUQS4KICAg4oCiIE1hcGE6CiAgICAgICAgMDogIlBlbmRlbnRlIgogICAgICAgIDE6ICJObyBww6F0aW8iCiAgICAgICAgMjogIkVtIGxlaWzDo28iCiAgICAgICAgNDogIkNsb25lIgogICAgICAgIDU6ICJFeGNsdWlyIgogICAgICAgIDY6ICJGcnVzdHJhZG8iCiAgICAgICAgMTAwOiAiUmV0aXJhZG8gcGVsbyBwcm9wcmlldMOhcmlvIgogICAgICAgIDEwMTogIlJldGlyYWRvIHBvciBsZWlsw6NvIgogICAgICAgIDEwMjogIlJldGlyYWRvIHBvciBkZWNpc8OjbyBqdWRpY2lhbCIKICAgICAgICAxMDQ6ICJSZXRpcmFkbyBwZWxvIHJlcHJlc2VudGFudGUgbGVnYWwiCiAgICAgICAgMTA1OiAiUmV0aXJhZG8gcG9yIHByZW5zYSIKICAgICAgICAxMDc6ICJSZXRpcmFkbyBwb3IgbGVpbMOjbyBleHRlcm5vIgogICAgICAgIDEwODogIlJldGlyYWRvIHBvciByb3Viby9mdXJ0byIKICAgICAgICAxMDk6ICJSZXRpcmFkbyBwb3IgbGVpbMOjbyBwZWxvIHJlcHJlc2VudGFudGUgbGVnYWwiCiAgICAgICAgMTEwOiAiUmV0aXJhZG8gcGVsbyByZXByZXNlbnRhbnRlIGxlZ2FsIC0gw5NiaXRvIgoKICAg8J+VkiBEYXRhcyDigJQgcmVtb3ZlciDigJwuMDAwMDAw4oCdIGUgZm9ybWF0YXIgZGQvTU0veXl5eSBISDptbQoKICAg8J+nrSBQb2xpY2lhbCDigJQgREVUQUxIRSBwb3IgaWQgKG51bmNhIHBvciBudW1lcm8pCgogICDwn6epIEVuZGVyZcOnbyDigJQgTElTVEEgb25seSAoc2VtIGRldGFsaGUpCgogICDwn5OLIFRTViDigJQgc2FuaXRpemHDp8OjbyBwYXJhIGNvbGFnZW0gcGVyZmVpdGEKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCihmdW5jdGlvbiAoKSB7CiAgInVzZSBzdHJpY3QiOwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IEVTVEFETyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCiAgY29uc3QgTFNfQkVBUkVSX0tFWSA9ICJncnZ0b29sc19sYXN0X2JlYXJlciI7CgogIGNvbnN0IFNUQVRFID0gewogICAgYXV0aEhlYWRlcjogbG9jYWxTdG9yYWdlLmdldEl0ZW0oTFNfQkVBUkVSX0tFWSkgfHwgIiIsCiAgICBsaXN0QmFzZTogIiIsICAgICAgICAgICAgIC8vIFVSTCBiYXNlIGRhIExJU1RBCiAgICBiYXNlTG9nZ2VkT25jZTogZmFsc2UsICAgIC8vIGxvZyDigJzinJMgQmFzZS4uLuKAnSAxeC8gc2Vzc8OjbwogICAgcm93c0FPQTogbnVsbCwgICAgICAgICAgICAvLyBtYXRyaXogcGFyYSBleHBvcnRhw6fDo28KICAgIC8vIOKtkCBOT1ZPOiBlc3RhZG8gdmlzdWFsIGRvIHBhaW5lbAogICAgbWluaW1pemVkOiBmYWxzZSwKICAgIC8vIGd1YXJkYSB0YW1hbmhvIGFudGVyaW9yIGFvIG1pbmltaXphciBwYXJhIHJlc3RhdXJhciBpZ3VhbAogICAgbGFzdFNpemU6IHsgdzogNjEwLCBoOiA1MjAgfSwgLy8gdmFsb3JlcyBwYWRyw6NvIGFwcm94aW1hZG9zCiAgfTsKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSBNQVBBUyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCiAgY29uc3QgU0lUVUFDQU9fTUFQID0gewogICAgMDoiUGVuZGVudGUiLDE6Ik5vIHDDoXRpbyIsMjoiRW0gbGVpbMOjbyIsNDoiQ2xvbmUiLDU6IkV4Y2x1aXIiLDY6IkZydXN0cmFkbyIsCiAgICAxMDA6IlJldGlyYWRvIHBlbG8gcHJvcHJpZXTDoXJpbyIsMTAxOiJSZXRpcmFkbyBwb3IgbGVpbMOjbyIsCiAgICAxMDI6IlJldGlyYWRvIHBvciBkZWNpc8OjbyBqdWRpY2lhbCIsMTA0OiJSZXRpcmFkbyBwZWxvIHJlcHJlc2VudGFudGUgbGVnYWwiLAogICAgMTA1OiJSZXRpcmFkbyBwb3IgcHJlbnNhIiwxMDc6IlJldGlyYWRvIHBvciBsZWlsw6NvIGV4dGVybm8iLAogICAgMTA4OiJSZXRpcmFkbyBwb3Igcm91Ym8vZnVydG8iLDEwOToiUmV0aXJhZG8gcG9yIGxlaWzDo28gcGVsbyByZXByZXNlbnRhbnRlIGxlZ2FsIiwKICAgIDExMDoiUmV0aXJhZG8gcGVsbyByZXByZXNlbnRhbnRlIGxlZ2FsIC0gw5NiaXRvIiwKICB9OwogIGNvbnN0IFJFVF9TVEFUVVMgPSBuZXcgU2V0KFsxMDAsMTAxLDEwMiwxMDQsMTA1LDEwNywxMDgsMTA5LDExMF0pOwoKICAvLyBPcMOnw7VlcyBkbyBmaWx0cm8gKHZhbG9yIGludGVybm8g4oaSIGxhYmVsIGV4aWJpZGEpCiAgY29uc3QgRklMVEVSX09QVElPTlMgPSBbCiAgICBbImFsbCIsIlRvZG9zIl0sWyIxIiwiTm8gcMOhdGlvIl0sWyIwIiwiUGVuZGVudGUiXSxbIjIiLCJFbSBsZWlsw6NvIl0sCiAgICBbIjQiLCJDbG9uZSJdLFsiNSIsIkV4Y2x1aXIiXSxbIjYiLCJGcnVzdHJhZG8iXSxbInJldCIsIlJldGlyYWRvcyAocXVhbHF1ZXIpIl0sCiAgICBbIjEwMCIsIlJldGlyYWRvIHBlbG8gcHJvcHJpZXTDoXJpbyJdLFsiMTAxIiwiUmV0aXJhZG8gcG9yIGxlaWzDo28iXSwKICAgIFsiMTAyIiwiUmV0aXJhZG8gcG9yIGRlY2lzw6NvIGp1ZGljaWFsIl0sWyIxMDQiLCJSZXRpcmFkbyBwZWxvIHJlcHJlc2VudGFudGUgbGVnYWwiXSwKICAgIFsiMTA1IiwiUmV0aXJhZG8gcG9yIHByZW5zYSJdLFsiMTA3IiwiUmV0aXJhZG8gcG9yIGxlaWzDo28gZXh0ZXJubyJdLAogICAgWyIxMDgiLCJSZXRpcmFkbyBwb3Igcm91Ym8vZnVydG8iXSxbIjEwOSIsIlJldGlyYWRvIHBvciBsZWlsw6NvIHBlbG8gcmVwcmVzZW50YW50ZSBsZWdhbCJdLAogICAgWyIxMTAiLCJSZXRpcmFkbyBwZWxvIHJlcHJlc2VudGFudGUgbGVnYWwgLSDDk2JpdG8iXSwKICBdOwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IFVUSUxTID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KICBjb25zdCBwMiA9IChuKSA9PiBTdHJpbmcobikucGFkU3RhcnQoMiwgIjAiKTsKICBjb25zdCB0cyA9ICgpID0+IHsgY29uc3QgZD1uZXcgRGF0ZSgpOyByZXR1cm4gYCR7ZC5nZXRGdWxsWWVhcigpfS0ke3AyKGQuZ2V0TW9udGgoKSsxKX0tJHtwMihkLmdldERhdGUoKSl9XyR7cDIoZC5nZXRIb3VycygpKX1oLiR7cDIoZC5nZXRNaW51dGVzKCkpfW1pbi4ke3AyKGQuZ2V0U2Vjb25kcygpKX1zZWdgOyB9OwogIGNvbnN0IHNsZWVwID0gKG1zKSA9PiBuZXcgUHJvbWlzZShyPT5zZXRUaW1lb3V0KHIsbXMpKTsKICBjb25zdCBzYWZlICA9ICh2KSA9PiAodj09bnVsbCB8fCB2PT09IiIpID8gIi0tLS0tIiA6IFN0cmluZyh2KTsKICBjb25zdCBtYXNrICA9IChzLG1heD01NCk9PiAhcyA/ICLigJQiIDogKHMubGVuZ3RoPm1heCA/IChzLnNsaWNlKDAsTWF0aC5mbG9vcihtYXgvMiktMSkrIuKApiIrcy5zbGljZSgtTWF0aC5mbG9vcihtYXgvMikpKSA6IHMpOwogIGNvbnN0IGxvZyAgID0gKG0pPT57IHRyeXsgaWYobG9nRWwpeyBsb2dFbC52YWx1ZSArPSBtICsgIlxuIjsgbG9nRWwuc2Nyb2xsVG9wID0gbG9nRWwuc2Nyb2xsSGVpZ2h0OyB9IH1jYXRjaHt9IH07CgogIGZ1bmN0aW9uIHVwZGF0ZUJhZGdlcygpewogICAgdHJ5ewogICAgICBiYWRnZVRvay50ZXh0Q29udGVudCAgPSAiVG9rZW46ICIgKyBtYXNrKFNUQVRFLmF1dGhIZWFkZXIsIDQ0KTsKICAgICAgYmFkZ2VUb2sudGl0bGUgICAgICAgID0gU1RBVEUuYXV0aEhlYWRlciB8fCAi4oCUIjsKICAgICAgYmFkZ2VCYXNlLnRleHRDb250ZW50ID0gIkJhc2U6ICIgKyBtYXNrKFNUQVRFLmxpc3RCYXNlLCA2MCk7CiAgICAgIGJhZGdlQmFzZS50aXRsZSAgICAgICA9IFNUQVRFLmxpc3RCYXNlIHx8ICLigJQiOwogICAgfWNhdGNoe30KICB9CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09IERFVEVDw4fDg08gREEgTElTVEEgPT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KICBmdW5jdGlvbiBpc0xpc3QodSl7CiAgICB0cnl7IGNvbnN0IHVybD1uZXcgVVJMKHUsbG9jYXRpb24ub3JpZ2luKTsgcmV0dXJuIC9eXC9hcGlcL2dydlwvPyQvLnRlc3QodXJsLnBhdGhuYW1lKTsgfWNhdGNoeyByZXR1cm4gZmFsc2U7IH0KICB9CiAgZnVuY3Rpb24gbm9ybWFsaXplQmFzZSh1KXsKICAgIHRyeXsKICAgICAgY29uc3QgdXJsPW5ldyBVUkwodSwgbG9jYXRpb24ub3JpZ2luKTsKICAgICAgWyJwYWdlIiwicGFnaW5hIiwiXyIsInQiLCJ0cyIsIm5vY2FjaGUiLCJjYWNoZUJ1c3QiLCJsaW1pdCIsInBlclBhZ2UiLCJwYWdlU2l6ZSIsInNpemUiLCJzdGF0dXMiXS5mb3JFYWNoKGs9PnVybC5zZWFyY2hQYXJhbXMuZGVsZXRlKGspKTsKICAgICAgdXJsLmhhc2g9IiI7CiAgICAgIHJldHVybiB1cmwub3JpZ2luICsgdXJsLnBhdGhuYW1lICsgKHVybC5zZWFyY2g/KCI/Iit1cmwuc2VhcmNoUGFyYW1zLnRvU3RyaW5nKCkpOiIiKTsKICAgIH1jYXRjaHsgcmV0dXJuIFN0cmluZyh1fHwiIik7IH0KICB9CiAgZnVuY3Rpb24gbGF0Y2hMaXN0QmFzZSh1KXsKICAgIGlmICghdSB8fCAhaXNMaXN0KHUpKSByZXR1cm47CiAgICBTVEFURS5saXN0QmFzZSA9IG5vcm1hbGl6ZUJhc2UodSk7CiAgICB1cGRhdGVCYWRnZXMoKTsKICAgIGlmICghU1RBVEUuYmFzZUxvZ2dlZE9uY2UpewogICAgICBTVEFURS5iYXNlTG9nZ2VkT25jZSA9IHRydWU7CiAgICAgIGxvZygi4pyTIEJhc2UgZGEgTElTVEEgZGV0ZWN0YWRhLiIpOwogICAgfQogIH0KCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IEJFQVJFUiBUT0tFTiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KICBmdW5jdGlvbiBzZXRCZWFyZXIodil7CiAgICBpZiAoIXYpIHJldHVybjsKICAgIGNvbnN0IHM9U3RyaW5nKHYpLnRyaW0oKTsKICAgIGlmICghcyB8fCBzPT09U1RBVEUuYXV0aEhlYWRlcikgcmV0dXJuOwogICAgU1RBVEUuYXV0aEhlYWRlcj1zOwogICAgdHJ5eyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShMU19CRUFSRVJfS0VZLCBzKTsgfWNhdGNoe30KICAgIHVwZGF0ZUJhZGdlcygpOwogIH0KICBjb25zdCBfZmV0Y2ggPSB3aW5kb3cuZmV0Y2g7CiAgd2luZG93LmZldGNoID0gZnVuY3Rpb24oaW5wdXQsIGluaXQpewogICAgdHJ5ewogICAgICBjb25zdCBoID0gaW5pdCAmJiBpbml0LmhlYWRlcnM7CiAgICAgIGlmIChoKXsKICAgICAgICBpZiAodHlwZW9mIGguZ2V0PT09ImZ1bmN0aW9uIil7CiAgICAgICAgICBjb25zdCB2ID0gaC5nZXQoIkF1dGhvcml6YXRpb24iKSB8fCBoLmdldCgiYXV0aG9yaXphdGlvbiIpOyBpZiAodikgc2V0QmVhcmVyKHYpOwogICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShoKSl7CiAgICAgICAgICBmb3IoY29uc3QgW2ssdl0gb2YgaCkgaWYgKFN0cmluZyhrKS50b0xvd2VyQ2FzZSgpPT09ImF1dGhvcml6YXRpb24iKSBzZXRCZWFyZXIodik7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaCA9PT0gIm9iamVjdCIpewogICAgICAgICAgZm9yKGNvbnN0IGsgaW4gaCkgaWYgKGsudG9Mb3dlckNhc2UoKT09PSJhdXRob3JpemF0aW9uIikgc2V0QmVhcmVyKGhba10pOwogICAgICAgIH0KICAgICAgfQogICAgfWNhdGNoe30KICAgIGNvbnN0IHVybCA9ICh0eXBlb2YgaW5wdXQ9PT0ic3RyaW5nIikgPyBpbnB1dCA6IChpbnB1dCAmJiBpbnB1dC51cmwpOwogICAgcmV0dXJuIF9mZXRjaC5hcHBseSh0aGlzLCBhcmd1bWVudHMpLnRoZW4ocmVzPT57CiAgICAgIHRyeXsKICAgICAgICBjb25zdCB1ID0gKHJlcyAmJiByZXMudXJsKSA/IHJlcy51cmwgOiAodXJsIHx8ICIiKTsKICAgICAgICBpZiAocmVzICYmIHJlcy5vayAmJiBpc0xpc3QodSkpIGxhdGNoTGlzdEJhc2UodSk7CiAgICAgIH1jYXRjaHt9CiAgICAgIHJldHVybiByZXM7CiAgICB9KTsKICB9OwogIGNvbnN0IFhIUiA9IHdpbmRvdy5YTUxIdHRwUmVxdWVzdDsKICBjb25zdCBfb3BlbiA9IFhIUi5wcm90b3R5cGUub3BlbjsKICBjb25zdCBfc2V0ICA9IFhIUi5wcm90b3R5cGUuc2V0UmVxdWVzdEhlYWRlcjsKICBjb25zdCBfc2VuZCA9IFhIUi5wcm90b3R5cGUuc2VuZDsKICBYSFIucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbihtLHUpeyB0aGlzLl9fdXJsPXU7IHJldHVybiBfb3Blbi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7IH07CiAgWEhSLnByb3RvdHlwZS5zZXRSZXF1ZXN0SGVhZGVyID0gZnVuY3Rpb24oayx2KXsgdHJ5eyBpZihTdHJpbmcoaykudG9Mb3dlckNhc2UoKT09PSJhdXRob3JpemF0aW9uIikgc2V0QmVhcmVyKHYpO31jYXRjaHt9IHJldHVybiBfc2V0LmFwcGx5KHRoaXMsYXJndW1lbnRzKTsgfTsKICBYSFIucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbigpewogICAgdHJ5ewogICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCAoKT0+eyB0cnl7IGlmICh0aGlzLnN0YXR1cz49MjAwICYmIHRoaXMuc3RhdHVzPDQwMCAmJiBpc0xpc3QodGhpcy5fX3VybCkpIGxhdGNoTGlzdEJhc2UodGhpcy5fX3VybCk7IH1jYXRjaHt9IH0pOwogICAgfWNhdGNoe30KICAgIHJldHVybiBfc2VuZC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7CiAgfTsKICBmdW5jdGlvbiB0cnlQZXJmKCl7CiAgICB0cnl7CiAgICAgIGNvbnN0IGVzPXBlcmZvcm1hbmNlLmdldEVudHJpZXNCeVR5cGUoInJlc291cmNlIik7CiAgICAgIGZvcihsZXQgaT1lcy5sZW5ndGgtMTtpPj0wO2ktLSl7IGNvbnN0IHU9ZXNbaV0ubmFtZXx8IiI7IGlmKGlzTGlzdCh1KSl7IGxhdGNoTGlzdEJhc2UodSk7IGJyZWFrOyB9IH0KICAgIH1jYXRjaHt9CiAgfQoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IFJFREUvTElTVEEgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKICAvLyDilrogQXBsaWNhIG8gZmlsdHJvIGRlIFNpdHVhw6fDo28gSsOBIE5BIEFQSSBhZGljaW9uYW5kbyBzdGF0dXM9IG5hIHF1ZXJ5LgogIGZ1bmN0aW9uIGFwcGx5U2VydmVyRmlsdGVyVG9VcmwodSwgZmlsdGVyVmFsdWUpewogICAgY29uc3QgdXJsID0gbmV3IFVSTCh1LCBsb2NhdGlvbi5vcmlnaW4pOwogICAgdXJsLnNlYXJjaFBhcmFtcy5kZWxldGUoInN0YXR1cyIpOwoKICAgIGlmIChmaWx0ZXJWYWx1ZSA9PT0gImFsbCIpIHJldHVybiB1cmwudG9TdHJpbmcoKTsKICAgIGlmIChmaWx0ZXJWYWx1ZSA9PT0gInJldCIpIHsgZm9yIChjb25zdCBzIG9mIFJFVF9TVEFUVVMpIHVybC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJzdGF0dXMiLCBTdHJpbmcocykpOyByZXR1cm4gdXJsLnRvU3RyaW5nKCk7IH0KICAgIGNvbnN0IHdhbnQgPSBOdW1iZXIoZmlsdGVyVmFsdWUpOwogICAgaWYgKE51bWJlci5pc0Zpbml0ZSh3YW50KSkgdXJsLnNlYXJjaFBhcmFtcy5hcHBlbmQoInN0YXR1cyIsIFN0cmluZyh3YW50KSk7CiAgICByZXR1cm4gdXJsLnRvU3RyaW5nKCk7CiAgfQoKICBhc3luYyBmdW5jdGlvbiBqZ2V0KHUpewogICAgY29uc3QgciA9IGF3YWl0IGZldGNoKHUsIHsgaGVhZGVyczogeyAiQXV0aG9yaXphdGlvbiI6IFNUQVRFLmF1dGhIZWFkZXIgfX0pOwogICAgY29uc3QgdCA9IGF3YWl0IHIudGV4dCgpOwogICAgdHJ5eyByZXR1cm4gSlNPTi5wYXJzZSh0KTsgfWNhdGNoeyB0aHJvdyBuZXcgRXJyb3IoIlJlc3Bvc3RhIG7Do28tSlNPTiIpOyB9CiAgfQoKICAvLyDilrogRm9yw6dhIDEwMCBwb3IgcMOhZ2luYQogIGZ1bmN0aW9uIHBhZ2VVcmwoYmFzZSwgbil7CiAgICBjb25zdCB1ID0gbmV3IFVSTChiYXNlLCBsb2NhdGlvbi5vcmlnaW4pOwogICAgaWYgKHUuc2VhcmNoUGFyYW1zLmhhcygicGFnZSIpKSB1LnNlYXJjaFBhcmFtcy5zZXQoInBhZ2UiLCBuKTsKICAgIGVsc2UgaWYgKHUuc2VhcmNoUGFyYW1zLmhhcygicGFnaW5hIikpIHUuc2VhcmNoUGFyYW1zLnNldCgicGFnaW5hIiwgbik7CiAgICBlbHNlIHUuc2VhcmNoUGFyYW1zLnNldCgicGFnZSIsIG4pOwogICAgdS5zZWFyY2hQYXJhbXMuc2V0KCJsaW1pdCIsIjEwMCIpOyB1LnNlYXJjaFBhcmFtcy5zZXQoInBlclBhZ2UiLCIxMDAiKTsKICAgIHUuc2VhcmNoUGFyYW1zLnNldCgicGFnZVNpemUiLCIxMDAiKTsgdS5zZWFyY2hQYXJhbXMuc2V0KCJzaXplIiwiMTAwIik7CiAgICByZXR1cm4gdS50b1N0cmluZygpOwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gZ2V0TGlzdFBhZ2UoYmFzZSwgbiwgZmlsdGVyVmFsdWUpewogICAgbGV0IHUgPSBwYWdlVXJsKGJhc2UsIG4pOwogICAgdSA9IGFwcGx5U2VydmVyRmlsdGVyVG9VcmwodSwgZmlsdGVyVmFsdWUpOwogICAgY29uc3QgZCA9IGF3YWl0IGpnZXQodSk7CiAgICBpZiAoQXJyYXkuaXNBcnJheShkKSkgcmV0dXJuIGQ7CiAgICBmb3IgKGNvbnN0IGsgb2YgWyJhcnJheURhdGEiLCJpdGVtcyIsImRhdGEiLCJyb3dzIiwicmVjb3JkcyJdKSBpZiAoQXJyYXkuaXNBcnJheShkPy5ba10pKSByZXR1cm4gZFtrXTsKICAgIHJldHVybiBbXTsKICB9CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PSBTSVRVQcOHw4NPIENBTsOUTklDQSA9PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KICBmdW5jdGlvbiBzaXR1YWNhb0Zyb21TdGF0dXMoY29kZSl7CiAgICBpZiAoUkVUX1NUQVRVUy5oYXMoY29kZSkpIHJldHVybiBTSVRVQUNBT19NQVBbY29kZV07CiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKFNJVFVBQ0FPX01BUCwgY29kZSkpIHJldHVybiBTSVRVQUNBT19NQVBbY29kZV07CiAgICByZXR1cm4gTnVtYmVyLmlzRmluaXRlKGNvZGUpID8gYFN0YXR1cyAke2NvZGV9YCA6ICItLS0tLSI7CiAgfQoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PSBGSUxUUk8gREUgU0lUVUHDh8ODTyAoZmFsbGJhY2spID09PT09PT09PT09PT09PT09ICovCiAgZnVuY3Rpb24gcGFzc0ZpbHRlcihjb2RlLCBmaWx0ZXJWYWx1ZSl7CiAgICBpZiAoZmlsdGVyVmFsdWUgPT09ICJhbGwiKSByZXR1cm4gdHJ1ZTsKICAgIGlmIChmaWx0ZXJWYWx1ZSA9PT0gInJldCIpIHJldHVybiBSRVRfU1RBVFVTLmhhcyhjb2RlKTsKICAgIGNvbnN0IHdhbnQgPSBOdW1iZXIoZmlsdGVyVmFsdWUpOwogICAgcmV0dXJuIE51bWJlci5pc0Zpbml0ZSh3YW50KSAmJiBjb2RlID09PSB3YW50OwogIH0KCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PSBEQVRBUyAoTElNUEVaQSkgPT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwogIGZ1bmN0aW9uIHBhcnNlRGF0ZUNhbmRpZGF0ZSh2KXsKICAgIGlmICh2ID09IG51bGwpIHJldHVybiBudWxsOwogICAgbGV0IHggPSB2OwogICAgaWYgKHR5cGVvZiB4ID09PSAib2JqZWN0IikgeCA9IHguZGF0ZSB8fCB4LmRhdGEgfHwgeC5kYXRhSG9yYSB8fCB4LnZhbHVlIHx8IHg7CiAgICBpZiAodHlwZW9mIHggIT09ICJzdHJpbmciKSB4ID0gU3RyaW5nKHgpOwogICAgbGV0IHQgPSB4LnRyaW0oKTsKICAgIGNvbnN0IG0gPSB0Lm1hdGNoKC9eKFxkezR9LVxkezJ9LVxkezJ9KVsgVF0oXGR7Mn06XGR7Mn06XGR7Mn0pKD86XC5cZHszLDZ9KT8kLyk7CiAgICBpZiAobSkgdCA9IGAke21bMV19VCR7bVsyXX1gOwogICAgY29uc3QgZCA9IG5ldyBEYXRlKHQpOwogICAgaWYgKCFpc05hTihkLmdldFRpbWUoKSkpIHJldHVybiBkOwogICAgcmV0dXJuIHQucmVwbGFjZSgvXC5cZHszLDZ9JC8sICIiKTsKICB9CiAgZnVuY3Rpb24gZm10QnIodmFsKXsKICAgIGNvbnN0IGQgPSBwYXJzZURhdGVDYW5kaWRhdGUodmFsKTsKICAgIGlmIChkID09IG51bGwpIHJldHVybiAiLS0tLS0iOwogICAgaWYgKGQgaW5zdGFuY2VvZiBEYXRlKSByZXR1cm4gYCR7cDIoZC5nZXREYXRlKCkpfS8ke3AyKGQuZ2V0TW9udGgoKSsxKX0vJHtkLmdldEZ1bGxZZWFyKCl9ICR7cDIoZC5nZXRIb3VycygpKX06JHtwMihkLmdldE1pbnV0ZXMoKSl9YDsKICAgIHJldHVybiBkOwogIH0KCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT0gRU5ERVJFw4dPIChMSVNUQS1PTkxZOyBPUENJT05BTCkgPT09PT09PT09PT09PT09PT09ICovCiAgZnVuY3Rpb24gcGlja0VuZGVyZWNvRnJvbUxpc3QoaXRlbSwgb3JpZ2luKXsKICAgIGlmIChvcmlnaW4gPT09ICJhcHJlZW5zYW8iKXsKICAgICAgcmV0dXJuIFsgc2FmZShpdGVtPy5lbmRlcmVjb0FwcmVlbnNhbyksIHNhZmUoaXRlbT8uYmFpcnJvQXByZWVuc2FvKSwgc2FmZShpdGVtPy5jaWRhZGVBcHJlZW5zYW8pLCBzYWZlKGl0ZW0/LnVmQXByZWVuc2FvKSwgc2FmZShpdGVtPy5jb21wbGVtZW50b0FwcmVlbnNhbykgXTsKICAgIH0gZWxzZSB7IC8vIHJlbW9jYW8KICAgICAgcmV0dXJuIFsgc2FmZShpdGVtPy5lbmRlcmVjb1JlbW9jYW8pLCBzYWZlKGl0ZW0/LmJhaXJyb1JlbW9jYW8pLCBzYWZlKGl0ZW0/LmNpZGFkZVJlbW9jYW8pLCBzYWZlKGl0ZW0/LnVmUmVtb2NhbyksIHNhZmUoaXRlbT8uY29tcGxlbWVudG9SZW1vY2FvKSBdOwogICAgfQogIH0KCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IFBPTElDSUFMIChERVRBTEhFKSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KICBmdW5jdGlvbiBnZXRQb2xpY2lhbE9maWNpYWxGcm9tRGV0YWxoZShkZXQpewogICAgY29uc3QgcCA9IGRldD8ucG9saWNpYWxBcHJlZW5zYW8gfHwgZGV0Py5wb2xpY2lhbCB8fCBkZXQ/LmFnZW50ZUFwcmVlbnNvciB8fCBudWxsOwogICAgY29uc3Qgbm9tZSA9IHNhZmUocD8ubm9tZSk7CiAgICBjb25zdCBtYXQgID0gc2FmZShwPy5tYXRyaWN1bGEpOwogICAgcmV0dXJuIHtub21lLCBtYXR9OwogIH0KCiAgZnVuY3Rpb24gcGFyc2VQb2xpY2lhbEZyb21PYnNlcnZhY2FvKHRleHQpewogICAgaWYgKCF0ZXh0KSByZXR1cm4ge25vbWVPYnM6Ii0tLS0tIiwgbWF0T2JzOiItLS0tLSJ9OwogICAgbGV0IHQgPSBTdHJpbmcodGV4dCkKICAgICAgLnJlcGxhY2UoL1xyXG4/L2csICJcbiIpLnJlcGxhY2UoL1x1MDBBMC9nLCAiICIpCiAgICAgIC5yZXBsYWNlKC9cKisvZywgIiIpLnJlcGxhY2UoL1sgXHRdKy9nLCAiICIpLnJlcGxhY2UoL1sgXHRdKlxuWyBcdF0qL2csICJcbiIpOwogICAgdCA9IHQucmVwbGFjZSgvKFxkKVteXFNcbl0qXG5bXlxTXG5dKihcZCkvZywgIiQxJDIiKTsKICAgIGNvbnN0IGRpZ2l0cyA9IHMgPT4gU3RyaW5nKHN8fCIiKS5yZXBsYWNlKC9cRCsvZywgIiIpOwogICAgY29uc3QgY2xlYW4gID0gcyA9PiBTdHJpbmcoc3x8IiIpLnJlcGxhY2UoL1sgXHRdKy9nLCAiICIpLnRyaW0oKTsKCiAgICBsZXQgbWF0T2JzID0gIi0tLS0tIjsKICAgIGNvbnN0IG0gPSB0Lm1hdGNoKC9cYig/Ok1hdFwuP1xzKlwvP1xzKlJHfE1hdHIoPzpcLnxbw61pXWN1bGEpP3xNYXRyaWMoPzp1bGEpP3xNYXRcLj98UkcoPzpcL0lEKT8pXGJccypbOlwtXT9ccyooW15cbl0rKS9pKTsKICAgIGlmIChtKXsKICAgICAgY29uc3QgZCA9IGRpZ2l0cyhtWzFdKTsKICAgICAgaWYgKGQubGVuZ3RoPj01ICYmIGQubGVuZ3RoPD0xMikgbWF0T2JzID0gZDsKICAgICAgZWxzZSB7IGNvbnN0IG1kID0gbVsxXS5tYXRjaCgvXGIoXGR7NSwxMn0pXGIvKTsgaWYgKG1kKSBtYXRPYnMgPSBtZFsxXTsgfQogICAgfSBlbHNlIHsKICAgICAgY29uc3QgbGluZSA9IHQuc3BsaXQoIlxuIikuZmluZChsID0+IC9cYk1hdC9pLnRlc3QobCkgfHwgL1xiUkdcYi9pLnRlc3QobCkpOwogICAgICBpZiAobGluZSl7CiAgICAgICAgY29uc3QgZHJvcCA9IGxpbmUucmVwbGFjZSgvQ2VsXC4/Oi4qJC9pLCAiIik7CiAgICAgICAgY29uc3QgZCA9IGRpZ2l0cyhkcm9wKTsgY29uc3QgbWQgPSBkLm1hdGNoKC8oXGR7NSwxMn0pLyk7CiAgICAgICAgaWYgKG1kKSBtYXRPYnMgPSBtZFsxXTsKICAgICAgfQogICAgfQoKICAgIGxldCBub21lT2JzID0gIi0tLS0tIjsKICAgIGxldCBuID0gdC5tYXRjaCgvXGJOb21lXHMqKD86ZVxzKkNhcmdvXC8/UGF0ZW50ZXxcLz9DYXJnb1wvP1BhdGVudGUpP1xzKjpccyooW15cbl0rKS9pKTsKICAgIGlmIChuKXsKICAgICAgbGV0IHNlZyA9IG5bMV07CiAgICAgIHNlZyA9IHNlZy5zcGxpdCgvXGIoTWF0XC4/XC8/Ukd8TWF0XC4/fE1hdHIoPzpcLnxbw61pXWN1bGEpP3xSRyg/OlwvSUQpP3xVbmlkYWRlfE5bwrpvXVxzKmRhXHMqVlRSfENlbFwuPylcYi9pKVswXTsKICAgICAgbm9tZU9icyA9IGNsZWFuKHNlZyk7CiAgICB9IGVsc2UgaWYgKChuID0gdC5tYXRjaCgvXGJOb21lXHMqOlxzKihbXlxuXSspL2kpKSl7CiAgICAgIGxldCBzZWcgPSBuWzFdOwogICAgICBzZWcgPSBzZWcuc3BsaXQoL1xiKENhcmdvfENhcmdvXC8/UGF0ZW50ZXxNYXRcLj9cLz9SR3xNYXRcLj98TWF0cig/OlwufFvDrWldY3VsYSk/fFJHKD86XC9JRCk/KVxiL2kpWzBdOwogICAgICBub21lT2JzID0gY2xlYW4oc2VnKTsKICAgIH0gZWxzZSBpZiAoKG4gPSB0Lm1hdGNoKC9cYihQb2xpY2lhbHxBcHJlZW5zb3J8QWdlbnRlfEluc3BldG9yfE9maWNpYWwpXHMqOlxzKihbXlxuXSspL2kpKSkgewogICAgICBub21lT2JzID0gY2xlYW4oblsyXSk7CiAgICB9IGVsc2UgewogICAgICBsZXQgYWZ0ZXIgPSB0OwogICAgICBjb25zdCBoID0gdC5tYXRjaCgvREFET1MgRE8gU09MSUNJVEFOVEUvaSk7CiAgICAgIGlmIChoKSBhZnRlciA9IHQuc2xpY2UoaC5pbmRleCArIGhbMF0ubGVuZ3RoKTsKICAgICAgY29uc3QgbGluZSA9IGFmdGVyLnNwbGl0KCJcbiIpLm1hcChzPT5zLnRyaW0oKSkKICAgICAgICAuZmluZChzID0+IHMgJiYgIS9eXGR7NSx9JC8udGVzdChkaWdpdHMocykpICYmICEvKFVuaWRhZGV8VlRSfENlbHxGb2kgYWNpb25hZG98Tm9tZSBkbyB0ZXJjZWlyb3xSR1wvSUQpL2kudGVzdChzKSk7CiAgICAgIGlmIChsaW5lKSBub21lT2JzID0gbGluZTsKICAgIH0KICAgIGlmIChub21lT2JzLmluY2x1ZGVzKCIvIikpewogICAgICBjb25zdCBbbGVmdCxyaWdodF0gPSBub21lT2JzLnNwbGl0KCIvIikubWFwKHM9PnMudHJpbSgpKTsKICAgICAgaWYgKHJpZ2h0ICYmIC9eKGNhYm98Y2JwbXxzZ3R8c29sZGFkb3xzZHx0ZW58dGVuZW50ZXxjYXB8Y2FwaXR8aW5zcHxhZ2VudGV8aW52ZXN0aWdhZG9yfG9maWNpYWwpXGIvaS50ZXN0KHJpZ2h0KSkgewogICAgICAgIG5vbWVPYnMgPSBsZWZ0OwogICAgICB9CiAgICB9CiAgICByZXR1cm4ge25vbWVPYnMsIG1hdE9ic307CiAgfQoKICBhc3luYyBmdW5jdGlvbiBmZXRjaERldGFsaGVCeUlkT3JOdW1lcm8obGlzdEl0ZW0pewogICAgY29uc3QgYXBpT3JpZ2luID0gKFNUQVRFLmxpc3RCYXNlID8gbmV3IFVSTChTVEFURS5saXN0QmFzZSkub3JpZ2luIDogbG9jYXRpb24ub3JpZ2luKTsKICAgIGNvbnN0IGhlYWRlcnMgPSB7ICJBdXRob3JpemF0aW9uIjogU1RBVEUuYXV0aEhlYWRlciwgIkFjY2VwdCI6ICJhcHBsaWNhdGlvbi9qc29uIiB9OwoKICAgIGFzeW5jIGZ1bmN0aW9uIGpnZXQyKHVybCl7CiAgICAgIGNvbnN0IHIgPSBhd2FpdCBmZXRjaCh1cmwsIHsgaGVhZGVycyB9KTsKICAgICAgY29uc3QgY3QgPSAoci5oZWFkZXJzLmdldCgiY29udGVudC10eXBlIikgfHwgIiIpLnRvTG93ZXJDYXNlKCk7CiAgICAgIGNvbnN0IHR4dCA9IGF3YWl0IHIudGV4dCgpOwogICAgICBpZiAoIWN0LmluY2x1ZGVzKCJqc29uIikpIHRocm93IG5ldyBFcnJvcihgbsOjby1KU09OICgke3Iuc3RhdHVzfSlgKTsKICAgICAgdHJ5IHsgcmV0dXJuIEpTT04ucGFyc2UodHh0KTsgfQogICAgICBjYXRjaChlKXsgdGhyb3cgbmV3IEVycm9yKGBqc29uIGludsOhbGlkbyAoJHtyLnN0YXR1c30pYCk7IH0KICAgIH0KCiAgICBjb25zdCBpZCA9IGxpc3RJdGVtPy5pZCB8fCBsaXN0SXRlbT8uZ3J2SWQgfHwgbnVsbDsKICAgIGlmIChpZCAhPSBudWxsKXsKICAgICAgcmV0dXJuIGF3YWl0IGpnZXQyKGAke2FwaU9yaWdpbn0vYXBpL2dydi8ke2lkfT9kYWRvc0V4dHJhcz10cnVlYCk7CiAgICB9CgogICAgY29uc3QgbnVtZXJvID0gbGlzdEl0ZW0/Lm51bWVybzsKICAgIGlmICghbnVtZXJvKSB0aHJvdyBuZXcgRXJyb3IoInNlbSBpZCBlIHNlbSBudW1lcm8iKTsKICAgIGNvbnN0IHFzID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7IG51bWVybzogU3RyaW5nKG51bWVybykgfSkudG9TdHJpbmcoKTsKCiAgICBjb25zdCBzZWFyY2ggPSBhd2FpdCBqZ2V0MihgJHthcGlPcmlnaW59L2FwaS9ncnY/JHtxc31gKTsKICAgIGxldCBmb3VuZCA9IG51bGw7CiAgICBpZiAoQXJyYXkuaXNBcnJheShzZWFyY2gpKXsKICAgICAgZm91bmQgPSBzZWFyY2hbMF07CiAgICB9IGVsc2UgaWYgKHNlYXJjaCAmJiB0eXBlb2Ygc2VhcmNoID09PSAib2JqZWN0Iil7CiAgICAgIGZvciAoY29uc3QgayBvZiBbImFycmF5RGF0YSIsIml0ZW1zIiwiZGF0YSIsInJvd3MiLCJyZWNvcmRzIl0pIHsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShzZWFyY2hba10pKSB7IGZvdW5kID0gc2VhcmNoW2tdWzBdOyBicmVhazsgfQogICAgICB9CiAgICAgIGlmICghZm91bmQgJiYgc2VhcmNoLmlkKSBmb3VuZCA9IHNlYXJjaDsKICAgIH0KICAgIGNvbnN0IHJpZCA9IGZvdW5kPy5pZCB8fCBmb3VuZD8uZ3J2SWQ7CiAgICBpZiAocmlkID09IG51bGwpIHRocm93IG5ldyBFcnJvcigibsOjbyBmb2kgcG9zc8OtdmVsIHJlc29sdmVyIGlkIHBlbG8gbnVtZXJvIik7CiAgICByZXR1cm4gYXdhaXQgamdldDIoYCR7YXBpT3JpZ2lufS9hcGkvZ3J2LyR7cmlkfT9kYWRvc0V4dHJhcz10cnVlYCk7CiAgfQoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0gTUFQRUFNRU5UTyBERSBMSU5IQSA9PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwogIGZ1bmN0aW9uIGJhc2VSb3coaXRlbSl7CiAgICBjb25zdCBjb2RlID0gTnVtYmVyKGl0ZW0/LnN0YXR1cyk7CiAgICBjb25zdCBzaXR1ID0gc2l0dWFjYW9Gcm9tU3RhdHVzKGNvZGUpOwogICAgY29uc3QgaXNSZXQgPSBSRVRfU1RBVFVTLmhhcyhjb2RlKTsKICAgIHJldHVybiBbCiAgICAgIHNhZmUoaXRlbT8ubnVtZXJvKSwKICAgICAgc2FmZShpdGVtPy5wbGFjYU9yaWdpbmFsKSwKICAgICAgc2FmZShpdGVtPy5wbGFjYSB8fCAiLS0tLSIpLAogICAgICBzYWZlKGl0ZW0/LmNoYXNzaSksCiAgICAgIGZtdEJyKGl0ZW0/LmRhdGFBcHJlZW5zYW8/LmRhdGUgfHwgaXRlbT8uZGF0YUFwcmVlbnNhbyB8fCBpdGVtPy5hcHJlZW5zYW9EYXRhKSwKICAgICAgaXNSZXQgPyBmbXRCcigKICAgICAgICBpdGVtPy5yZXRpcmFkYT8uZGF0YVJldGlyYWRhPy5kYXRlIHx8CiAgICAgICAgaXRlbT8uZGF0YVJldGlyYWRhPy5kYXRlIHx8IGl0ZW0/LmRhdGFSZXRpcmFkYSB8fAogICAgICAgIGl0ZW0/LmRhdGFTYWlkYVBhdGlvPy5kYXRlIHx8IGl0ZW0/LmRhdGFTYWlkYVBhdGlvIHx8CiAgICAgICAgaXRlbT8uYmFpeGE/LmRhdGUgfHwgaXRlbT8ubGliZXJhY2FvPy5kYXRlCiAgICAgICkgOiAiLS0tLS0iLAogICAgICBzYWZlKGl0ZW0/Lm1hcmNhIHx8IGl0ZW0/Lm1hcmNhTW9kZWxvIHx8IGl0ZW0/Lm1vZGVsbyksCiAgICAgIHNhZmUoaXRlbT8ucGF0aW8/Lm5vbWUgfHwgaXRlbT8ucGF0aW9Ob21lKSwKICAgICAgc2FmZShpdGVtPy52YWdhKSwKICAgICAgc2FmZShpdGVtPy5udW1lcm9DaGF2ZSksCiAgICAgIHNpdHUKICAgIF07CiAgfQoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSBVSSAoUEFJTkVMKSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwogIGxldCBwYW5lbCwgbG9nRWwsIGJhZGdlVG9rLCBiYWRnZUJhc2UsIGluU3RhcnQsIGluRW5kLCBzZWxGaWx0ZXIsIGJ0blJ1biwgYnRuWExTWCwgYnRuQ29weSwgYnRuQ29weUxvZzsKICBsZXQgY2hrQWRkciwgYWRkckJveCwgcmFkQXAsIHJhZFJtLCByYWRCb3RoOwogIGxldCBjaGtQb2wsIHBvbEJveCwgY2hrUG9sT2ZpY2lhbCwgY2hrUG9sT2JzOwoKICAvLyDirZAgTk9WTzogcmVmcyBleHRyYXMgKG1pbmltaXphci9yZXNpemUpCiAgbGV0IGJ0bk1pbiwgYm9keVdyYXA7CiAgbGV0IHJlc0wsIHJlc1IsIHJlc1QsIHJlc0I7IC8vIGhhbmRsZXMgZGUgYm9yZGEKCiAgZnVuY3Rpb24gYnVpbGRQYW5lbCgpewogICAgcGFuZWw9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBwYW5lbC5zdHlsZS5jc3NUZXh0PVsKICAgICAgInBvc2l0aW9uOmZpeGVkIiwicmlnaHQ6MjBweCIsImJvdHRvbToyMHB4Iiwiei1pbmRleDoyMTQ3NDgzNjQ3IiwKICAgICAgImJhY2tncm91bmQ6IzBkMTExNyIsImNvbG9yOiNlNmVkZjMiLCJib3JkZXI6MXB4IHNvbGlkICMzMDM2M2QiLAogICAgICAiYm9yZGVyLXJhZGl1czoxMHB4Iiwid2lkdGg6NjEwcHgiLCJib3gtc2hhZG93OjAgOHB4IDIwcHggcmdiYSgwLDAsMCwuNTUpIiwKICAgICAgImZvbnQtZmFtaWx5OlNlZ29lIFVJLEFyaWFsLHNhbnMtc2VyaWYiLCJmb250LXNpemU6MTNweCIsCiAgICAgICJtaW4td2lkdGg6MzIwcHgiLCJtaW4taGVpZ2h0OjEwMHB4IiAvLyDirZAgTk9WTzogbGltaXRlcyBtw61uaW1vcwogICAgXS5qb2luKCI7Iik7CgogICAgcGFuZWwuaW5uZXJIVE1MPWAKICAgICAgPGRpdiBpZD0iZ3J2X2hlYWQiIHN0eWxlPSJwYWRkaW5nOjZweCAxMHB4O2Rpc3BsYXk6ZmxleDtnYXA6OHB4O2FsaWduLWl0ZW1zOmNlbnRlcjtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjMzAzNjNkO2N1cnNvcjptb3ZlO2JhY2tncm91bmQ6IzAxMDQwOTsiPgogICAgICAgIDxiIGlkPSJncnZfdGl0bGUiIHN0eWxlPSJmbGV4OjE7Ij5HUlYgVG9vbHMgY29tIEVuZGVyZcOnbyBlIFBvbGljaWFsIDMgZW0gMSB2MS40LjM8L2I+CiAgICAgICAgPHNwYW4gaWQ9Imdydl9iYWRnZV90b2siICBzdHlsZT0iZm9udC1zaXplOjEwcHg7b3BhY2l0eTouOTttYXgtd2lkdGg6MjAwcHg7d2hpdGUtc3BhY2U6bm93cmFwO292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzIj5Ub2tlbjog4oCUPC9zcGFuPgogICAgICAgIDxzcGFuIGlkPSJncnZfYmFkZ2VfYmFzZSIgc3R5bGU9ImZvbnQtc2l6ZToxMHB4O29wYWNpdHk6Ljk7bWF4LXdpZHRoOjI2MHB4O3doaXRlLXNwYWNlOm5vd3JhcDtvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpcyI+QmFzZTog4oCUPC9zcGFuPgoKICAgICAgICA8IS0tIOKtkCBOT1ZPOiBib3TDo28gTWluaW1pemFyIC0tPgogICAgICAgIDxidXR0b24gaWQ9Imdydl9taW4iIHRpdGxlPSJNaW5pbWl6YXIgLyBSZXN0YXVyYXIiCiAgICAgICAgICAgICAgICBzdHlsZT0ibWFyZ2luLWxlZnQ6OHB4O3dpZHRoOjI2cHg7aGVpZ2h0OjI0cHg7bGluZS1oZWlnaHQ6MjBweDtib3JkZXItcmFkaXVzOjZweDtiYWNrZ3JvdW5kOiMxNjFiMjI7Y29sb3I6I2U2ZWRmMztib3JkZXI6MXB4IHNvbGlkICMzMDM2M2Q7Y3Vyc29yOnBvaW50ZXIiPuKAkzwvYnV0dG9uPgogICAgICA8L2Rpdj4KCiAgICAgIDwhLS0g4q2QIE5PVk86IGVtYnJ1bGhvIGRvIGNvcnBvIChmYWNpbGl0YSBlc2NvbmRlci9tb3N0cmFyIG5vIG1pbmltaXphcikgLS0+CiAgICAgIDxkaXYgaWQ9Imdydl9ib2R5Ij4KCiAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczoxZnIgMWZyIDFmcjtnYXA6OHB4O3BhZGRpbmc6OHB4OyI+CiAgICAgICAgICA8ZGl2PjxsYWJlbCBzdHlsZT0iZm9udC1zaXplOjExcHg7b3BhY2l0eTouOCI+SW7DrWNpbyAocMOhZ2luYSk8L2xhYmVsPjxpbnB1dCBpZD0iZ3J2X3N0YXJ0IiB0eXBlPSJudW1iZXIiIG1pbj0iMSIgdmFsdWU9IjEiIHN0eWxlPSJ3aWR0aDoxMDAlO2JhY2tncm91bmQ6IzBkMTExNztjb2xvcjojZTZlZGYzO2JvcmRlcjoxcHggc29saWQgIzMwMzYzZDtib3JkZXItcmFkaXVzOjZweDtwYWRkaW5nOjZweCI+PC9kaXY+CiAgICAgICAgICA8ZGl2PjxsYWJlbCBzdHlsZT0iZm9udC1zaXplOjExcHg7b3BhY2l0eTouOCI+RmltICgwID0gYXTDqSB6ZXJhcik8L2xhYmVsPjxpbnB1dCBpZD0iZ3J2X2VuZCIgdHlwZT0ibnVtYmVyIiBtaW49IjAiIHZhbHVlPSI1IiBzdHlsZT0id2lkdGg6MTAwJTtiYWNrZ3JvdW5kOiMwZDExMTc7Y29sb3I6I2U2ZWRmMztib3JkZXI6MXB4IHNvbGlkICMzMDM2M2Q7Ym9yZGVyLXJhZGl1czo2cHg7cGFkZGluZzo2cHgiPjwvZGl2PgogICAgICAgICAgPGRpdj4KICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXNpemU6MTFweDtvcGFjaXR5Oi44Ij5GaWx0cmFyIFNpdHVhw6fDo288L2xhYmVsPgogICAgICAgICAgICA8c2VsZWN0IGlkPSJncnZfZmlsdGVyIiBzdHlsZT0id2lkdGg6MTAwJTtiYWNrZ3JvdW5kOiMwZDExMTc7Y29sb3I6I2U2ZWRmMztib3JkZXI6MXB4IHNvbGlkICMzMDM2M2Q7Ym9yZGVyLXJhZGl1czo2cHg7cGFkZGluZzo2cHgiPjwvc2VsZWN0PgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MTBweDtvcGFjaXR5Oi43O21hcmdpbi10b3A6NHB4Ij5QYWRyw6NvIGZpeG86ICJObyBww6F0aW8iPC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBzdHlsZT0icGFkZGluZzowIDhweCA2cHggOHB4O2ZvbnQtc2l6ZToxMXB4O29wYWNpdHk6Ljg1Ij4KICAgICAgICAgIE8gc2NyaXB0IGZvcsOnYSA8Yj4xMDAgcG9yIHDDoWdpbmE8L2I+IGUgaW5qZXRhIDxjb2RlPnN0YXR1cz08L2NvZGU+IG5hIEFQSSBjb25mb3JtZSBvIGZpbHRybyBkbyBzY3JpcHQuCiAgICAgICAgICBTZSDigJxGaW3igJ09NSwgYSBtZXRhIMOpIGp1bnRhciA8Yj41MDAgbWFudGlkb3M8L2I+IHBlbG8gZmlsdHJvIChvdSBhdMOpIGEgbGlzdGEgemVyYXIpLgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IHN0eWxlPSJwYWRkaW5nOjhweDtib3JkZXItdG9wOjFweCBzb2xpZCAjMzAzNjNkIj4KICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6OHB4O2N1cnNvcjpwb2ludGVyIj4KICAgICAgICAgICAgPGlucHV0IGlkPSJncnZfYWRkcl9lbmFibGUiIHR5cGU9ImNoZWNrYm94Ij4KICAgICAgICAgICAgPHNwYW4+SW5jbHVpciBlbmRlcmXDp288L3NwYW4+CiAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgPGRpdiBpZD0iZ3J2X2FkZHJfYm94IiBzdHlsZT0iZGlzcGxheTpub25lO21hcmdpbi10b3A6NnB4O3BhZGRpbmc6OHB4O2JhY2tncm91bmQ6IzBhMGYxNDtib3JkZXI6MXB4IHNvbGlkICMzMDM2M2Q7Ym9yZGVyLXJhZGl1czo2cHgiPgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjZweDtmb250LXNpemU6MTJweDtvcGFjaXR5Oi45Ij5PcmlnZW06PC9kaXY+CiAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0ibWFyZ2luLXJpZ2h0OjEycHgiPjxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0iZ3J2X2FkZHJfb3JpZ2luIiB2YWx1ZT0iYXByZWVuc2FvIiBjaGVja2VkPiBBcHJlZW5zw6NvPC9sYWJlbD4KICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJtYXJnaW4tcmlnaHQ6MTJweCI+PGlucHV0IHR5cGU9InJhZGlvIiBuYW1lPSJncnZfYWRkcl9vcmlnaW4iIHZhbHVlPSJyZW1vY2FvIj4gUmVtb8Onw6NvPC9sYWJlbD4KICAgICAgICAgICAgPGxhYmVsPjxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0iZ3J2X2FkZHJfb3JpZ2luIiB2YWx1ZT0iYW1ib3MiPiBBbWJvczwvbGFiZWw+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMHB4O29wYWNpdHk6Ljc7bWFyZ2luLXRvcDo2cHgiPkxJU1RBLW9ubHk7IGNhbXBvcyBhdXNlbnRlcyBmaWNhbSAiLS0tLS0iLjwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgc3R5bGU9InBhZGRpbmc6OHB4O2JvcmRlci10b3A6MXB4IHNvbGlkICMzMDM2M2QiPgogICAgICAgICAgPGxhYmVsIHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo4cHg7Y3Vyc29yOnBvaW50ZXIiPgogICAgICAgICAgICA8aW5wdXQgaWQ9Imdydl9wb2xfZW5hYmxlIiB0eXBlPSJjaGVja2JveCI+CiAgICAgICAgICAgIDxzcGFuPkluY2x1aXIgcG9saWNpYWwgKHVzYSBERVRBTEhFKTwvc3Bhbj4KICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICA8ZGl2IGlkPSJncnZfcG9sX2JveCIgc3R5bGU9ImRpc3BsYXk6bm9uZTttYXJnaW4tdG9wOjZweDtwYWRkaW5nOjhweDtiYWNrZ3JvdW5kOiMwYTBmMTQ7Ym9yZGVyOjFweCBzb2xpZCAjMzAzNjNkO2JvcmRlci1yYWRpdXM6NnB4Ij4KICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJtYXJnaW4tcmlnaHQ6MTJweCI+PGlucHV0IGlkPSJncnZfcG9sX29maWNpYWwiIHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPiBPZmljaWFpcyAobm9tZS9tYXRyw61jdWxhKTwvbGFiZWw+CiAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgaWQ9Imdydl9wb2xfb2JzIiB0eXBlPSJjaGVja2JveCI+IE9ic2VydmHDp8OjbyAobm9tZS9tYXRyw61jdWxhKTwvbGFiZWw+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMHB4O29wYWNpdHk6Ljc7bWFyZ2luLXRvcDo2cHgiPkRFVEFMSEUgY29tIDIgd29ya2VycyBmaXhvczsgZmFsaGFzIHByZWVuY2hlbSAiLS0tLS0iIGUgc8OjbyBsb2dhZGFzLjwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6OHB4O3BhZGRpbmc6OHB4O2ZsZXgtd3JhcDp3cmFwO2JvcmRlci10b3A6MXB4IHNvbGlkICMzMDM2M2QiPgogICAgICAgICAgPGJ1dHRvbiBpZD0iZ3J2X3J1biIgICBzdHlsZT0iZmxleDoxO3BhZGRpbmc6OHB4O2JvcmRlci1yYWRpdXM6NnB4O2JhY2tncm91bmQ6IzIzODYzNjtjb2xvcjojZmZmO2JvcmRlcjoxcHggc29saWQgIzJlYTA0MztjdXJzb3I6cG9pbnRlciI+Q2FwdHVyYXI8L2J1dHRvbj4KICAgICAgICAgIDxidXR0b24gaWQ9Imdydl94bHN4IiAgc3R5bGU9ImZsZXg6MTtwYWRkaW5nOjhweDtib3JkZXItcmFkaXVzOjZweDtiYWNrZ3JvdW5kOiMxZjZmZWI7Y29sb3I6I2ZmZjtib3JkZXI6MXB4IHNvbGlkICMzODhiZmQ7Y3Vyc29yOnBvaW50ZXIiIGRpc2FibGVkPkJhaXhhciBYTFNYPC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIGlkPSJncnZfY29weSIgIHN0eWxlPSJmbGV4OjE7cGFkZGluZzo4cHg7Ym9yZGVyLXJhZGl1czo2cHg7YmFja2dyb3VuZDojOWU2YzAwO2NvbG9yOiNmZmY7Ym9yZGVyOjFweCBzb2xpZCAjYjg4NDAwO2N1cnNvcjpwb2ludGVyIiBkaXNhYmxlZD5Db3BpYXIgVFNWPC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIGlkPSJncnZfY29weV9sb2ciIHN0eWxlPSJmbGV4OjE7cGFkZGluZzo4cHg7Ym9yZGVyLXJhZGl1czo2cHg7YmFja2dyb3VuZDojNmU3NjgxO2NvbG9yOiMwZDExMTc7Ym9yZGVyOjFweCBzb2xpZCAjOGI5NDllO2N1cnNvcjpwb2ludGVyIj5Db3BpYXIgTG9nPC9idXR0b24+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDx0ZXh0YXJlYSBpZD0iZ3J2X2xvZyIgcmVhZG9ubHkgc3R5bGU9IndpZHRoOmNhbGMoMTAwJSAtIDE2cHgpO21hcmdpbjowIDhweCA4cHg7aGVpZ2h0OjI0MHB4O2JhY2tncm91bmQ6IzBhMGYxNDtjb2xvcjojZDFmN2M0O2JvcmRlcjoxcHggc29saWQgIzMwMzYzZDtib3JkZXItcmFkaXVzOjZweDtyZXNpemU6dmVydGljYWw7Zm9udC1mYW1pbHk6dWktbW9ub3NwYWNlLENvbnNvbGFzLE1lbmxvLG1vbm9zcGFjZTtmb250LXNpemU6MTJweDtwYWRkaW5nOjhweCI+PC90ZXh0YXJlYT4KICAgICAgPC9kaXY+CiAgICBgOwoKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocGFuZWwpOwoKICAgIC8vIOKtkCBOT1ZPOiBIYW5kbGVzIGRlIHJlc2l6ZSBuYXMgNCBib3JkYXMgKGxhcmd1cmEgNnB4OyBhbHR1cmEgNnB4KQogICAgZm9yIChjb25zdCBbaWQsY3NzXSBvZiBbCiAgICAgIFsiZ3J2X3Jlc19sIiwibGVmdDowO3RvcDowO2hlaWdodDoxMDAlO3dpZHRoOjZweDtjdXJzb3I6ZXctcmVzaXplIl0sCiAgICAgIFsiZ3J2X3Jlc19yIiwicmlnaHQ6MDt0b3A6MDtoZWlnaHQ6MTAwJTt3aWR0aDo2cHg7Y3Vyc29yOmV3LXJlc2l6ZSJdLAogICAgICBbImdydl9yZXNfdCIsImxlZnQ6MDt0b3A6MDt3aWR0aDoxMDAlO2hlaWdodDo2cHg7Y3Vyc29yOm5zLXJlc2l6ZSJdLAogICAgICBbImdydl9yZXNfYiIsImxlZnQ6MDtib3R0b206MDt3aWR0aDoxMDAlO2hlaWdodDo2cHg7Y3Vyc29yOm5zLXJlc2l6ZSJdLAogICAgXSl7CiAgICAgIGNvbnN0IGg9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIGguaWQ9aWQ7IGguc3R5bGUuY3NzVGV4dD1gcG9zaXRpb246YWJzb2x1dGU7JHtjc3N9O3VzZXItc2VsZWN0Om5vbmVgOwogICAgICBwYW5lbC5hcHBlbmRDaGlsZChoKTsKICAgIH0KCiAgICAvLyBhcnJhc3RhciBwYWluZWwgKGNhYmXDp2FsaG8pCiAgICBjb25zdCBoZWFkPXBhbmVsLnF1ZXJ5U2VsZWN0b3IoIiNncnZfaGVhZCIpOyBsZXQgc3g9MCxzeT0wLG94PTAsb3k9MCxkcmFnPWZhbHNlOwogICAgaGVhZC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWRvd24iLGU9PnsgaWYgKGUudGFyZ2V0LmlkPT09Imdydl9taW4iKSByZXR1cm47IGRyYWc9dHJ1ZTtzeD1lLmNsaWVudFg7c3k9ZS5jbGllbnRZO2NvbnN0IHI9cGFuZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7b3g9ci5sZWZ0O295PXIudG9wOyB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLGU9PnsgaWYoIWRyYWcpIHJldHVybjsgcGFuZWwuc3R5bGUubGVmdD0ob3grZS5jbGllbnRYLXN4KSsicHgiOyBwYW5lbC5zdHlsZS50b3A9KG95K2UuY2xpZW50WS1zeSkrInB4IjsgcGFuZWwuc3R5bGUucmlnaHQ9ImF1dG8iOyBwYW5lbC5zdHlsZS5ib3R0b209ImF1dG8iOyB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXVwIiwoKT0+ZHJhZz1mYWxzZSk7CgogICAgLy8gcmVmcwogICAgYm9keVdyYXAgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCIjZ3J2X2JvZHkiKTsKICAgIGJ0bk1pbiAgID0gcGFuZWwucXVlcnlTZWxlY3RvcigiI2dydl9taW4iKTsKCiAgICBsb2dFbCAgICAgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCIjZ3J2X2xvZyIpOwogICAgYmFkZ2VUb2sgID0gcGFuZWwucXVlcnlTZWxlY3RvcigiI2dydl9iYWRnZV90b2siKTsKICAgIGJhZGdlQmFzZSA9IHBhbmVsLnF1ZXJ5U2VsZWN0b3IoIiNncnZfYmFkZ2VfYmFzZSIpOwogICAgaW5TdGFydCAgID0gcGFuZWwucXVlcnlTZWxlY3RvcigiI2dydl9zdGFydCIpOwogICAgaW5FbmQgICAgID0gcGFuZWwucXVlcnlTZWxlY3RvcigiI2dydl9lbmQiKTsKICAgIHNlbEZpbHRlciA9IHBhbmVsLnF1ZXJ5U2VsZWN0b3IoIiNncnZfZmlsdGVyIik7CiAgICBidG5SdW4gICAgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCIjZ3J2X3J1biIpOwogICAgYnRuWExTWCAgID0gcGFuZWwucXVlcnlTZWxlY3RvcigiI2dydl94bHN4Iik7CiAgICBidG5Db3B5ICAgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCIjZ3J2X2NvcHkiKTsKICAgIGJ0bkNvcHlMb2c9IHBhbmVsLnF1ZXJ5U2VsZWN0b3IoIiNncnZfY29weV9sb2ciKTsKCiAgICBjaGtBZGRyICAgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCIjZ3J2X2FkZHJfZW5hYmxlIik7CiAgICBhZGRyQm94ICAgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCIjZ3J2X2FkZHJfYm94Iik7CiAgICByYWRBcCAgICAgPSBhZGRyQm94LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3ZhbHVlPSJhcHJlZW5zYW8iXScpOwogICAgcmFkUm0gICAgID0gYWRkckJveC5xdWVyeVNlbGVjdG9yKCdpbnB1dFt2YWx1ZT0icmVtb2NhbyJdJyk7CiAgICByYWRCb3RoICAgPSBhZGRyQm94LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3ZhbHVlPSJhbWJvcyJdJyk7CgogICAgY2hrUG9sICAgID0gcGFuZWwucXVlcnlTZWxlY3RvcigiI2dydl9wb2xfZW5hYmxlIik7CiAgICBwb2xCb3ggICAgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCIjZ3J2X3BvbF9ib3giKTsKICAgIGNoa1BvbE9maWNpYWwgPSBwb2xCb3gucXVlcnlTZWxlY3RvcigiI2dydl9wb2xfb2ZpY2lhbCIpOwogICAgY2hrUG9sT2JzICAgICA9IHBvbEJveC5xdWVyeVNlbGVjdG9yKCIjZ3J2X3BvbF9vYnMiKTsKCiAgICByZXNMID0gcGFuZWwucXVlcnlTZWxlY3RvcigiI2dydl9yZXNfbCIpOwogICAgcmVzUiA9IHBhbmVsLnF1ZXJ5U2VsZWN0b3IoIiNncnZfcmVzX3IiKTsKICAgIHJlc1QgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCIjZ3J2X3Jlc190Iik7CiAgICByZXNCID0gcGFuZWwucXVlcnlTZWxlY3RvcigiI2dydl9yZXNfYiIpOwoKICAgIC8vIHBvcHVsYSBmaWx0cm8gKHBhZHLDo28gZml4bzog4oCcTm8gcMOhdGlv4oCdKQogICAgZm9yIChjb25zdCBbdmFsLGxhYmVsXSBvZiBGSUxURVJfT1BUSU9OUyl7CiAgICAgIGNvbnN0IG9wdD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsgb3B0LnZhbHVlPXZhbDsgb3B0LnRleHRDb250ZW50PWxhYmVsOwogICAgICBzZWxGaWx0ZXIuYXBwZW5kQ2hpbGQob3B0KTsKICAgIH0KICAgIHNlbEZpbHRlci52YWx1ZSA9ICIxIjsKCiAgICAvLyBldmVudG9zIHByaW5jaXBhaXMKICAgIGJ0blJ1bi5vbmNsaWNrICA9IG9uUnVuOwogICAgYnRuWExTWC5vbmNsaWNrID0gZG93bmxvYWRYTFNYOwogICAgYnRuQ29weS5vbmNsaWNrID0gY29weVRTVjsKICAgIGJ0bkNvcHlMb2cub25jbGljayA9ICgpPT5uYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChsb2dFbC52YWx1ZSkudGhlbigoKT0+bG9nKCJMb2cgY29waWFkby4iKSwoKT0+bG9nKCJGYWxoYSBhbyBjb3BpYXIgbG9nLiIpKTsKCiAgICBjaGtBZGRyLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsICgpPT57IGFkZHJCb3guc3R5bGUuZGlzcGxheSA9IGNoa0FkZHIuY2hlY2tlZCA/ICJibG9jayIgOiAibm9uZSI7IH0pOwogICAgY2hrUG9sLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsICAoKT0+eyBwb2xCb3guc3R5bGUuZGlzcGxheSAgPSBjaGtQb2wuY2hlY2tlZCAgPyAiYmxvY2siIDogIm5vbmUiOyB9KTsKCiAgICAvLyDirZAgTk9WTzogTWluaW1pemFyL1Jlc3RhdXJhcgogICAgYnRuTWluLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdG9nZ2xlTWluaW1pemUpOwogICAgaGVhZC5hZGRFdmVudExpc3RlbmVyKCJkYmxjbGljayIsIHRvZ2dsZU1pbmltaXplKTsgLy8gYXRhbGhvIHBlbG8gdMOtdHVsbwoKICAgIC8vIOKtkCBOT1ZPOiBSZXNpemUgcGVsYXMgYm9yZGFzCiAgICBhdHRhY2hSZXNpemUocmVzTCwgIkwiKTsKICAgIGF0dGFjaFJlc2l6ZShyZXNSLCAiUiIpOwogICAgYXR0YWNoUmVzaXplKHJlc1QsICJUIik7CiAgICBhdHRhY2hSZXNpemUocmVzQiwgIkIiKTsKCiAgICB1cGRhdGVCYWRnZXMoKTsKICAgIHNldFRpbWVvdXQodHJ5UGVyZiwgMjUwKTsKICB9CgogIC8vIOKtkCBOT1ZPOiBhbHRlcm5hIGVzdGFkbyBtaW5pbWl6YWRvIHNlbSBhZmV0YXIgbMOzZ2ljYSBkZSBjYXB0dXJhCiAgZnVuY3Rpb24gdG9nZ2xlTWluaW1pemUoKXsKICAgIFNUQVRFLm1pbmltaXplZCA9ICFTVEFURS5taW5pbWl6ZWQ7CiAgICBpZiAoU1RBVEUubWluaW1pemVkKXsKICAgICAgLy8gZ3VhcmRhIHRhbWFuaG8gYXR1YWwgcGFyYSByZXN0YXVyYXIgZGVwb2lzCiAgICAgIGNvbnN0IHIgPSBwYW5lbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgU1RBVEUubGFzdFNpemUudyA9IHIud2lkdGg7IFNUQVRFLmxhc3RTaXplLmggPSByLmhlaWdodDsKICAgICAgYm9keVdyYXAuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgbG9nRWwgJiYgKGxvZ0VsLnN0eWxlLmRpc3BsYXkgPSAibm9uZSIpOyAvLyAoasOhIGZpY2EgZGVudHJvIGRvIGJvZHkpCiAgICAgIHBhbmVsLnN0eWxlLmhlaWdodCA9ICJhdXRvIjsgLy8gZW5jb2xoZSBhbyBjYWJlw6dhbGhvCiAgICAgIGJ0bk1pbi50ZXh0Q29udGVudCA9ICIrIjsKICAgICAgYnRuTWluLnRpdGxlID0gIlJlc3RhdXJhciI7CiAgICB9IGVsc2UgewogICAgICBib2R5V3JhcC5zdHlsZS5kaXNwbGF5ID0gIiI7CiAgICAgIGxvZ0VsICYmIChsb2dFbC5zdHlsZS5kaXNwbGF5ID0gIiIpOwogICAgICBwYW5lbC5zdHlsZS53aWR0aCAgPSBTVEFURS5sYXN0U2l6ZS53ICsgInB4IjsKICAgICAgcGFuZWwuc3R5bGUuaGVpZ2h0ID0gU1RBVEUubGFzdFNpemUuaCArICJweCI7CiAgICAgIGJ0bk1pbi50ZXh0Q29udGVudCA9ICLigJMiOwogICAgICBidG5NaW4udGl0bGUgPSAiTWluaW1pemFyIjsKICAgIH0KICB9CgogIC8vIOKtkCBOT1ZPOiByZWRpbWVuc2lvbmFtZW50byBwb3IgYm9yZGFzCiAgLy8gRGljYXMgZGUgZXN0dWRvOgogIC8vIC0gTC9SIGFqdXN0YW0gbGFyZ3VyYTsgVC9CIGFqdXN0YW0gYWx0dXJhLgogIC8vIC0gRW0gTC9UIHRhbWLDqW0gbW92ZW1vcyBhIG9yaWdlbSBwYXJhIHByZXNlcnZhciBvIGxhZG8gb3Bvc3RvLgogIC8vIC0gTGltaXRlcyBtw61uaW1vcyByZXNwZWl0YWRvcyAobWluLXdpZHRoL2hlaWdodCBkbyBwYWluZWwpLgogIGZ1bmN0aW9uIGF0dGFjaFJlc2l6ZShoYW5kbGUsIHNpZGUpewogICAgbGV0IHN0YXJ0WD0wLCBzdGFydFk9MCwgc3RhcnRSZWN0PW51bGw7CiAgICBjb25zdCBvbk1vdmUgPSAoZSk9PnsKICAgICAgaWYgKCFzdGFydFJlY3QpIHJldHVybjsKICAgICAgY29uc3QgZHggPSBlLmNsaWVudFggLSBzdGFydFg7CiAgICAgIGNvbnN0IGR5ID0gZS5jbGllbnRZIC0gc3RhcnRZOwogICAgICBsZXQgdyA9IHN0YXJ0UmVjdC53aWR0aDsKICAgICAgbGV0IGggPSBzdGFydFJlY3QuaGVpZ2h0OwogICAgICBsZXQgbGVmdCA9IHN0YXJ0UmVjdC5sZWZ0OwogICAgICBsZXQgdG9wICA9IHN0YXJ0UmVjdC50b3A7CgogICAgICBpZiAoc2lkZT09PSJSIikgdyA9IE1hdGgubWF4KDMyMCwgc3RhcnRSZWN0LndpZHRoICsgZHgpOwogICAgICBpZiAoc2lkZT09PSJMIil7IHcgPSBNYXRoLm1heCgzMjAsIHN0YXJ0UmVjdC53aWR0aCAtIGR4KTsgbGVmdCA9IHN0YXJ0UmVjdC5sZWZ0ICsgZHg7IH0KICAgICAgaWYgKHNpZGU9PT0iQiIpIGggPSBNYXRoLm1heCgxMDAsIHN0YXJ0UmVjdC5oZWlnaHQgKyBkeSk7CiAgICAgIGlmIChzaWRlPT09IlQiKXsgaCA9IE1hdGgubWF4KDEwMCwgc3RhcnRSZWN0LmhlaWdodCAtIGR5KTsgdG9wICA9IHN0YXJ0UmVjdC50b3AgKyBkeTsgfQoKICAgICAgcGFuZWwuc3R5bGUud2lkdGggID0gdyArICJweCI7CiAgICAgIHBhbmVsLnN0eWxlLmhlaWdodCA9IGggKyAicHgiOwogICAgICBpZiAoc2lkZT09PSJMIiB8fCBzaWRlPT09IlQiKXsKICAgICAgICBwYW5lbC5zdHlsZS5sZWZ0ID0gbGVmdCArICJweCI7CiAgICAgICAgcGFuZWwuc3R5bGUudG9wICA9IHRvcCAgKyAicHgiOwogICAgICAgIHBhbmVsLnN0eWxlLnJpZ2h0ID0gImF1dG8iOwogICAgICAgIHBhbmVsLnN0eWxlLmJvdHRvbT0gImF1dG8iOwogICAgICB9CiAgICB9OwogICAgY29uc3Qgb25VcCA9ICgpPT57IHN0YXJ0UmVjdD1udWxsOyB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2Vtb3ZlIiwgb25Nb3ZlKTsgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1vdXNldXAiLCBvblVwKTsgfTsKICAgIGhhbmRsZS5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWRvd24iLCAoZSk9PnsKICAgICAgLy8gRXZpdGEgY29uZmxpdG8gY29tIGRyYWcgZG8gY2FiZcOnYWxobwogICAgICBlLnByZXZlbnREZWZhdWx0KCk7IGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGNvbnN0IHIgPSBwYW5lbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgc3RhcnRSZWN0ID0ge2xlZnQ6ci5sZWZ0LCB0b3A6ci50b3AsIHdpZHRoOnIud2lkdGgsIGhlaWdodDpyLmhlaWdodH07CiAgICAgIHN0YXJ0WCA9IGUuY2xpZW50WDsgc3RhcnRZID0gZS5jbGllbnRZOwogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vtb3ZlIiwgb25Nb3ZlKTsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNldXAiLCBvblVwKTsKICAgIH0pOwogIH0KCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PSBDQUJFw4dBTEhPIERJTsOCTUlDTyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCiAgZnVuY3Rpb24gYnVpbGRIZWFkZXIoaW5jbHVkZUFkZHIsIG9yaWdpbiwgcG9sT24sIHBvbE9mLCBwb2xPYnMpewogICAgY29uc3QgYmFzZSA9IFsiR1JWIiwiUGxhY2EgT3JpZ2luYWwiLCJQbGFjYSBPc3RlbnRhZGEiLCJDaGFzc2kiLCJEYXRhIGRhIEFwcmVlbnPDo28iLCJEYXRhIGRhIFJldGlyYWRhIiwiTWFyY2EvTW9kZWxvIiwiUMOhdGlvIiwiVmFnYSIsIk7CuiBkYSBDaGF2ZSIsIlNpdHVhw6fDo28iXTsKICAgIGNvbnN0IG91dCA9IGJhc2Uuc2xpY2UoKTsKICAgIGlmIChpbmNsdWRlQWRkcil7CiAgICAgIGNvbnN0IGFwID0gWyJMb2dyYWRvdXJvIChhcHJlZW5zw6NvKSIsIkJhaXJybyAoYXByZWVuc8OjbykiLCJDaWRhZGUgKGFwcmVlbnPDo28pIiwiVUYgKGFwcmVlbnPDo28pIiwiQ29tcGxlbWVudG8gKGFwcmVlbnPDo28pIl07CiAgICAgIGNvbnN0IHJtID0gWyJMb2dyYWRvdXJvIChyZW1vw6fDo28pIiwiQmFpcnJvIChyZW1vw6fDo28pIiwiQ2lkYWRlIChyZW1vw6fDo28pIiwiVUYgKHJlbW/Dp8OjbykiLCJDb21wbGVtZW50byAocmVtb8Onw6NvKSJdOwogICAgICBpZiAob3JpZ2luPT09ImFwcmVlbnNhbyIpIG91dC5wdXNoKC4uLmFwKTsKICAgICAgZWxzZSBpZiAob3JpZ2luPT09InJlbW9jYW8iKSBvdXQucHVzaCguLi5ybSk7CiAgICAgIGVsc2Ugb3V0LnB1c2goLi4uYXAsIC4uLnJtKTsKICAgIH0KICAgIGlmIChwb2xPbil7CiAgICAgIGlmIChwb2xPZil7IG91dC5wdXNoKCJQb2xpY2lhbCBhcHJlZW5zb3IiLCJNYXRyw61jdWxhIik7IH0KICAgICAgaWYgKHBvbE9icyl7IG91dC5wdXNoKCJQb2xpY2lhbCBhcHJlZW5zb3IgKG9ic2VydmHDp8OjbykiLCJNYXRyw61jdWxhIChvYnNlcnZhw6fDo28pIik7IH0KICAgIH0KICAgIHJldHVybiBvdXQ7CiAgfQogIGZ1bmN0aW9uIGFwcGVuZEFkZHJlc3NJZk5lZWRlZChyb3csIGl0ZW0sIGluY2x1ZGVBZGRyLCBvcmlnaW4pewogICAgaWYgKCFpbmNsdWRlQWRkcikgcmV0dXJuIHJvdzsKICAgIGlmIChvcmlnaW49PT0iYXByZWVuc2FvIikgcmV0dXJuIHJvdy5jb25jYXQocGlja0VuZGVyZWNvRnJvbUxpc3QoaXRlbSwiYXByZWVuc2FvIikpOwogICAgaWYgKG9yaWdpbj09PSJyZW1vY2FvIikgICByZXR1cm4gcm93LmNvbmNhdChwaWNrRW5kZXJlY29Gcm9tTGlzdChpdGVtLCJyZW1vY2FvIikpOwogICAgcmV0dXJuIHJvdy5jb25jYXQocGlja0VuZGVyZWNvRnJvbUxpc3QoaXRlbSwiYXByZWVuc2FvIiksIHBpY2tFbmRlcmVjb0Zyb21MaXN0KGl0ZW0sInJlbW9jYW8iKSk7CiAgfQoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gQ09SRSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KICBhc3luYyBmdW5jdGlvbiBvblJ1bigpewogICAgaWYgKCFTVEFURS5hdXRoSGVhZGVyKXsgbG9nKCJFUlJPOiB0b2tlbiBuw6NvIGNhcHR1cmFkby4iKTsgcmV0dXJuOyB9CiAgICBpZiAoIVNUQVRFLmxpc3RCYXNlKXsgdHJ5UGVyZigpOyB9CiAgICBpZiAoIVNUQVRFLmxpc3RCYXNlKXsgbG9nKCJFUlJPOiBiYXNlIGRhIGxpc3RhIG7Do28gZGV0ZWN0YWRhLiBOYXZlZ3VlIDEgcMOhZ2luYSBvdSBzZWxlY2lvbmUgMTAwIHBvciBww6FnaW5hLiIpOyByZXR1cm47IH0KCiAgICBjb25zdCBzdGFydCA9IE1hdGgubWF4KDEsIHBhcnNlSW50KGluU3RhcnQudmFsdWV8fCIxIiwxMCkpOwogICAgY29uc3QgZW5kICAgPSBNYXRoLm1heCgwLCBwYXJzZUludChpbkVuZC52YWx1ZXx8IjUiLDEwKSk7CiAgICBjb25zdCBmaWx0ZXJWYWx1ZSA9IHNlbEZpbHRlci52YWx1ZSB8fCAiMSI7IC8vIGRlZmF1bHQgTm8gcMOhdGlvCgogICAgY29uc3QgaW5jbHVkZUFkZHIgPSAhIWNoa0FkZHIuY2hlY2tlZDsKICAgIGNvbnN0IG9yaWdpbiA9IGluY2x1ZGVBZGRyID8gKHJhZEFwLmNoZWNrZWQgPyAiYXByZWVuc2FvIiA6IChyYWRSbS5jaGVja2VkID8gInJlbW9jYW8iIDogImFtYm9zIikpIDogImFwcmVlbnNhbyI7CgogICAgY29uc3QgaW5jbHVkZVBvbCA9ICEhY2hrUG9sLmNoZWNrZWQ7CiAgICBjb25zdCBwb2xPZiA9IGluY2x1ZGVQb2wgJiYgISFjaGtQb2xPZmljaWFsLmNoZWNrZWQ7CiAgICBjb25zdCBwb2xPYnMgPSBpbmNsdWRlUG9sICYmICEhY2hrUG9sT2JzLmNoZWNrZWQ7CgogICAgY29uc3QgZmlsdGVyTGFiZWwgPSBGSUxURVJfT1BUSU9OUy5maW5kKGY9PmZbMF09PT1maWx0ZXJWYWx1ZSk/LlsxXSB8fCBmaWx0ZXJWYWx1ZTsKICAgIGNvbnN0IGFkZHJMYWJlbCA9IGluY2x1ZGVBZGRyID8gb3JpZ2luIDogIm7Do28iOwogICAgY29uc3QgcG9sTGFiZWwgID0gaW5jbHVkZVBvbCA/IChgb2ZpY2lhaXM9JHtwb2xPZj8ic2ltIjoibsOjbyJ9OyBvYnM9JHtwb2xPYnM/InNpbSI6Im7Do28ifWApIDogIm7Do28iOwogICAgbG9nKGBJbsOtY2lvOiAke3N0YXJ0fSB8IEZpbTogJHtlbmR8fCJhdMOpIHplcmFyIn0gfCBGaWx0cm8gKHNjcmlwdC9BUEkpOiAke2ZpbHRlckxhYmVsfSB8IEVuZGVyZcOnbzogJHthZGRyTGFiZWx9IHwgUG9saWNpYWw6ICR7cG9sTGFiZWx9YCk7CiAgICBsb2coYEJhc2UgdXNhZGE6ICR7U1RBVEUubGlzdEJhc2V9YCk7CiAgICBpZiAoZW5kPjApIGxvZyhgTWV0YTogJHtlbmQqMTAwfSBtYW50aWRvcyBwZWxvIGZpbHRyby5gKTsKCiAgICBjb25zdCBoZWFkZXIgPSBidWlsZEhlYWRlcihpbmNsdWRlQWRkciwgb3JpZ2luLCBpbmNsdWRlUG9sLCBwb2xPZiwgcG9sT2JzKTsKICAgIGNvbnN0IGFvYSA9IFtoZWFkZXJdOwoKICAgIGNvbnN0IHRhcmdldEtlcHQgPSBlbmQgPiAwID8gKGVuZCAqIDEwMCkgOiBudWxsOwoKICAgIGxldCBwYWdlPXN0YXJ0LHRvdGFsPTAsa2VwdD0wLGVtcHR5PTA7CiAgICBjb25zdCB0YXNrcyA9IFtdOyAvLyBmaWxhIGRlIGRldGFsaGVzCgogICAgd2hpbGUodHJ1ZSl7CiAgICAgIGlmICh0YXJnZXRLZXB0ICE9IG51bGwgJiYga2VwdCA+PSB0YXJnZXRLZXB0KSBicmVhazsKCiAgICAgIGxvZyhg4oaSIFDDoWdpbmEgJHtwYWdlfeKApmApOwogICAgICBsZXQgaXRlbXM9W107CiAgICAgIHRyeXsgaXRlbXMgPSBhd2FpdCBnZXRMaXN0UGFnZShTVEFURS5saXN0QmFzZSwgcGFnZSwgZmlsdGVyVmFsdWUpOyB9CiAgICAgIGNhdGNoKGUpeyBsb2coYEVSUk8gQVBJOiAke2UgJiYgZS5tZXNzYWdlIHx8IGV9YCk7IGJyZWFrOyB9CgogICAgICBpZiAoIWl0ZW1zIHx8IGl0ZW1zLmxlbmd0aD09PTApewogICAgICAgIGxvZyhgUMOhZ2luYSAke3BhZ2V9OiAwIGl0ZW5zLmApOwogICAgICAgIGVtcHR5Kys7IGJyZWFrOwogICAgICB9CgogICAgICBlbXB0eT0wOwogICAgICBsZXQga2VwdFRoaXNQYWdlID0gMDsKICAgICAgZm9yIChjb25zdCBpdCBvZiBpdGVtcyl7CiAgICAgICAgY29uc3QgY29kZSA9IE51bWJlcihpdD8uc3RhdHVzKTsKICAgICAgICBpZiAoIXBhc3NGaWx0ZXIoY29kZSwgZmlsdGVyVmFsdWUpKSBjb250aW51ZTsKCiAgICAgICAgY29uc3QgYmFzZSA9IGJhc2VSb3coaXQpOwogICAgICAgIGNvbnN0IHdpdGhBZGRyID0gYXBwZW5kQWRkcmVzc0lmTmVlZGVkKGJhc2UsIGl0LCBpbmNsdWRlQWRkciwgb3JpZ2luKTsKCiAgICAgICAgY29uc3Qgcm93SW5kZXggPSBhb2EubGVuZ3RoOwogICAgICAgIGFvYS5wdXNoKHdpdGhBZGRyKTsKICAgICAgICBrZXB0Kys7IGtlcHRUaGlzUGFnZSsrOwoKICAgICAgICBpZiAoaW5jbHVkZVBvbCAmJiAocG9sT2YgfHwgcG9sT2JzKSl7CiAgICAgICAgICB0YXNrcy5wdXNoKHtyb3dJbmRleCwgaXRlbTogaXR9KTsKICAgICAgICB9CgogICAgICAgIGlmICh0YXJnZXRLZXB0ICE9IG51bGwgJiYga2VwdCA+PSB0YXJnZXRLZXB0KSBicmVhazsKICAgICAgfQogICAgICB0b3RhbCArPSBpdGVtcy5sZW5ndGg7CiAgICAgIGxvZyhg4pyTICR7aXRlbXMubGVuZ3RofSBpdGVucyByZWNlYmlkb3M7IG1hbnRpZG9zIG5lc3RhIHDDoWdpbmE6ICR7a2VwdFRoaXNQYWdlfTsgbWFudGlkb3MgYWN1bXVsYWRvczogJHtrZXB0fS5gKTsKCiAgICAgIGlmICh0YXJnZXRLZXB0ICE9IG51bGwgJiYga2VwdCA+PSB0YXJnZXRLZXB0KSBicmVhazsKICAgICAgcGFnZSsrOyBhd2FpdCBzbGVlcCgzMCk7CiAgICB9CgogICAgaWYgKGluY2x1ZGVQb2wgJiYgKHBvbE9mIHx8IHBvbE9icykgJiYgdGFza3MubGVuZ3RoPjApewogICAgICBsb2coYFtwb2xpY2lhbF0gaW5pY2lhbmRvIGRldGFsaGUgcGFyYSAke3Rhc2tzLmxlbmd0aH0gbGluaGEocykgKDIgd29ya2VycylgKTsKICAgICAgYXdhaXQgcnVuRGV0YWlsV29ya2Vycyh0YXNrcywgYW9hLCB7cG9sT2YsIHBvbE9ic30pOwogICAgfQoKICAgIFNUQVRFLnJvd3NBT0EgPSBhb2E7CiAgICBidG5YTFNYLmRpc2FibGVkID0gZmFsc2U7CiAgICBidG5Db3B5LmRpc2FibGVkID0gZmFsc2U7CiAgICBsb2coYENvbmNsdcOtZG8uIEl0ZW5zIHJlY2ViaWRvcyAoYnJ1dG9zKTogJHt0b3RhbH0uIExpbmhhcyBleHBvcnTDoXZlaXMgKHDDs3MtZmlsdHJvKTogJHthb2EubGVuZ3RoLTF9LmApOwogIH0KCiAgLy8gMiB3b3JrZXJzIGZpeG9zLCBjb20gcmV0cmllcyBsZXZlcyBlIGJhY2tvZmYKICBhc3luYyBmdW5jdGlvbiBydW5EZXRhaWxXb3JrZXJzKHRhc2tzLCBhb2EsIG9wdHMpewogICAgY29uc3Qge3BvbE9mLCBwb2xPYnN9ID0gb3B0czsKICAgIGxldCBpZHggPSAwOwogICAgY29uc3QgbmV4dCA9ICgpPT4gKGlkeCA8IHRhc2tzLmxlbmd0aCkgPyB0YXNrc1tpZHgrK10gOiBudWxsOwoKICAgIGFzeW5jIGZ1bmN0aW9uIGZldGNoV2l0aFJldHJ5KGpvYil7CiAgICAgIGNvbnN0IE1BWCA9IDM7CiAgICAgIGZvciAobGV0IGE9MTsgYTw9TUFYOyBhKyspewogICAgICAgIHRyeSB7IHJldHVybiBhd2FpdCBmZXRjaERldGFsaGVCeUlkT3JOdW1lcm8oam9iLml0ZW0pOyB9CiAgICAgICAgY2F0Y2goZSl7CiAgICAgICAgICBpZiAoYT09PU1BWCkgdGhyb3cgZTsKICAgICAgICAgIGNvbnN0IHdhaXQgPSA0MDAgKiBhOwogICAgICAgICAgYXdhaXQgc2xlZXAod2FpdCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYXN5bmMgZnVuY3Rpb24gd29ya2VyKGlkKXsKICAgICAgd2hpbGUodHJ1ZSl7CiAgICAgICAgY29uc3Qgam9iID0gbmV4dCgpOwogICAgICAgIGlmICgham9iKSBicmVhazsKICAgICAgICB0cnl7CiAgICAgICAgICBjb25zdCBkZXQgPSBhd2FpdCBmZXRjaFdpdGhSZXRyeShqb2IpOwogICAgICAgICAgY29uc3QgY29scyA9IFtdOwogICAgICAgICAgaWYgKHBvbE9mKXsKICAgICAgICAgICAgY29uc3Qge25vbWUsIG1hdH0gPSBnZXRQb2xpY2lhbE9maWNpYWxGcm9tRGV0YWxoZShkZXQpOwogICAgICAgICAgICBjb2xzLnB1c2goc2FmZShub21lKSwgc2FmZShtYXQpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChwb2xPYnMpewogICAgICAgICAgICBjb25zdCBvYnMgPSBkZXQ/Lm9ic2VydmFjb2VzIHx8IGRldD8ub2JzZXJ2YWNhbyB8fCBkZXQ/Lm9ic2VydmFjb2VzVmVpY3VsbyB8fCAiIjsKICAgICAgICAgICAgY29uc3Qge25vbWVPYnMsIG1hdE9ic30gPSBwYXJzZVBvbGljaWFsRnJvbU9ic2VydmFjYW8ob2JzKTsKICAgICAgICAgICAgY29scy5wdXNoKHNhZmUobm9tZU9icyksIHNhZmUobWF0T2JzKSk7CiAgICAgICAgICB9CiAgICAgICAgICBhb2Fbam9iLnJvd0luZGV4XSA9IGFvYVtqb2Iucm93SW5kZXhdLmNvbmNhdChjb2xzKTsKICAgICAgICB9IGNhdGNoKGUpewogICAgICAgICAgbG9nKGBbcG9saWNpYWxdIGZhbGhhICgke2UgJiYgZS5tZXNzYWdlIHx8IGV9KSBlbSBHUlYgJHtqb2IuaXRlbT8ubnVtZXJvIHx8ICI/In1gKTsKICAgICAgICAgIGNvbnN0IGNvbHMgPSBbXTsKICAgICAgICAgIGlmIChwb2xPZikgY29scy5wdXNoKCItLS0tLSIsIi0tLS0tIik7CiAgICAgICAgICBpZiAocG9sT2JzKSBjb2xzLnB1c2goIi0tLS0tIiwiLS0tLS0iKTsKICAgICAgICAgIGFvYVtqb2Iucm93SW5kZXhdID0gYW9hW2pvYi5yb3dJbmRleF0uY29uY2F0KGNvbHMpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgYXdhaXQgUHJvbWlzZS5hbGwoW3dvcmtlcigxKSwgd29ya2VyKDIpXSk7CiAgfQoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSBFWFBPUlRTID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCiAgZnVuY3Rpb24gZG93bmxvYWRYTFNYKCl7CiAgICBpZighU1RBVEUucm93c0FPQSl7IGxvZygiTmFkYSBwYXJhIGV4cG9ydGFyLiIpOyByZXR1cm47IH0KICAgIGlmKCEod2luZG93LlhMU1ggJiYgWExTWC51dGlscykpeyBsb2coIkFndWFyZGUgbyBtw7NkdWxvIFhMU1ggY2FycmVnYXIgZSB0ZW50ZSBkZSBub3ZvLiIpOyByZXR1cm47IH0KICAgIGNvbnN0IHdzID0gWExTWC51dGlscy5hb2FfdG9fc2hlZXQoU1RBVEUucm93c0FPQSk7CiAgICBjb25zdCB3YiA9IFhMU1gudXRpbHMuYm9va19uZXcoKTsKICAgIFhMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod2IsIHdzLCAiR1JWIik7CiAgICBjb25zdCB3Ym91dCA9IFhMU1gud3JpdGUod2IsIHtib29rVHlwZToieGxzeCIsIHR5cGU6ImFycmF5In0pOwogICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFt3Ym91dF0sIHt0eXBlOiJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0ifSk7CiAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgYS5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgIGEuZG93bmxvYWQgPSBgZ3J2X2xpc3RhXyR7dHMoKX0ueGxzeGA7CiAgICBhLmNsaWNrKCk7IHNldFRpbWVvdXQoKCk9PlVSTC5yZXZva2VPYmplY3RVUkwoYS5ocmVmKSwgNDAwKTsKICB9CgogIGFzeW5jIGZ1bmN0aW9uIGNvcHlUU1YoKXsKICAgIGlmKCFTVEFURS5yb3dzQU9BKXsgbG9nKCJOYWRhIHBhcmEgY29waWFyLiIpOyByZXR1cm47IH0KICAgIGNvbnN0IHNhbml0aXplRm9yVFNWID0gKHYpID0+IHsKICAgICAgaWYgKHYgPT0gbnVsbCkgcmV0dXJuICIiOwogICAgICByZXR1cm4gU3RyaW5nKHYpLnJlcGxhY2UoL1xyP1xuL2csICIgIikucmVwbGFjZSgvXHQvZywgIiAiKS5yZXBsYWNlKC9cdTAwQTAvZywgIiAiKS5yZXBsYWNlKC9cc3syLH0vZywgIiAiKS50cmltKCk7CiAgICB9OwogICAgY29uc3QgdHN2ID0gU1RBVEUucm93c0FPQS5tYXAocm93ID0+IHJvdy5tYXAoc2FuaXRpemVGb3JUU1YpLmpvaW4oIlx0IikpLmpvaW4oIlxyXG4iKTsKICAgIHRyeSB7CiAgICAgIGlmIChuYXZpZ2F0b3IuY2xpcGJvYXJkICYmIHdpbmRvdy5DbGlwYm9hcmRJdGVtKSB7CiAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFt0c3ZdLCB7IHR5cGU6ICJ0ZXh0L3RhYi1zZXBhcmF0ZWQtdmFsdWVzIiB9KTsKICAgICAgICBjb25zdCBpdGVtID0gbmV3IENsaXBib2FyZEl0ZW0oeyAidGV4dC90YWItc2VwYXJhdGVkLXZhbHVlcyI6IGJsb2IsICJ0ZXh0L3BsYWluIjogYmxvYiB9KTsKICAgICAgICBhd2FpdCBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlKFtpdGVtXSk7CiAgICAgICAgbG9nKCJDb3BpYWRvIChUU1YpLiBDb2xlIG5vIEdvb2dsZSBTaGVldHMvRXhjZWwuIik7IHJldHVybjsKICAgICAgfQogICAgfSBjYXRjaCB7fQogICAgdHJ5IHsKICAgICAgaWYgKG5hdmlnYXRvci5jbGlwYm9hcmQgJiYgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQpIHsKICAgICAgICBhd2FpdCBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCh0c3YpOwogICAgICAgIGxvZygiQ29waWFkbyAoVFNWKS4gQ29sZSBubyBHb29nbGUgU2hlZXRzL0V4Y2VsLiIpOyByZXR1cm47CiAgICAgIH0KICAgIH0gY2F0Y2gge30KICAgIHRyeSB7CiAgICAgIGNvbnN0IHRhPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRleHRhcmVhIik7CiAgICAgIHRhLnN0eWxlLnBvc2l0aW9uPSJmaXhlZCI7IHRhLnN0eWxlLmxlZnQ9Ii05OTk5cHgiOyB0YS52YWx1ZT10c3Y7CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGEpOwogICAgICB0YS5mb2N1cygpOyB0YS5zZWxlY3QoKTsKICAgICAgY29uc3Qgb2s9ZG9jdW1lbnQuZXhlY0NvbW1hbmQoImNvcHkiKTsKICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0YSk7CiAgICAgIGxvZyhvayA/ICJDb3BpYWRvIChUU1YpLiBDb2xlIG5vIEdvb2dsZSBTaGVldHMvRXhjZWwuIgogICAgICAgICAgICAgOiAiRmFsaGEgYW8gY29waWFyLiBTZWxlY2lvbmUgZSBjb3BpZSBtYW51YWxtZW50ZS4iKTsKICAgIH0gY2F0Y2ggewogICAgICBsb2coIkZhbGhhIGFvIGNvcGlhci4gU2VsZWNpb25lIGUgY29waWUgbWFudWFsbWVudGUuIik7CiAgICB9CiAgfQoKICAvLyBTaGVldEpTIHBhcmEgWExTWAogIGNvbnN0IHM9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CiAgcy5zcmM9Imh0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL3hsc3gvMC4xOC41L3hsc3guZnVsbC5taW4uanMiOwogIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQocyk7CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSBCT09UID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwogIGZ1bmN0aW9uIGJvb3QoKXsKICAgIGlmIChkb2N1bWVudC5ib2R5KSBidWlsZFBhbmVsKCk7CiAgICBlbHNlIHsKICAgICAgY29uc3QgbW89bmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCk9PnsgaWYoZG9jdW1lbnQuYm9keSl7IG1vLmRpc2Nvbm5lY3QoKTsgYnVpbGRQYW5lbCgpOyB9IH0pOwogICAgICBtby5vYnNlcnZlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudHx8ZG9jdW1lbnQsIHtjaGlsZExpc3Q6dHJ1ZSxzdWJ0cmVlOnRydWV9KTsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCAoKT0+eyBpZighcGFuZWwpIGJ1aWxkUGFuZWwoKTsgfSwge29uY2U6dHJ1ZX0pOwogICAgfQogIH0KICBib290KCk7Cn0pKCk7Cg==";
  const bin = (typeof atob === "function") ? atob(b) : (typeof Buffer !== "undefined" ? Buffer.from(b, "base64").toString("binary") : b);
  let src;
  try { src = new TextDecoder("utf-8").decode(Uint8Array.from(bin, c => c.charCodeAt(0))); }
  catch(e) { try { src = decodeURIComponent(escape(bin)); } catch (_e) { src = bin; } }
  (0, eval)(src);
})();
